var e;import{R as o,j as n,r as t,a as c}from"./svmessenger-vendor-react.js";import{R as a,a as r,L as i}from"./svmessenger-vendor-livekit.js";import{g as l,c as s,s as d}from"./svmessenger-svHelpers.js";import"./svmessenger-vendor.js";import"./svmessenger-vendor-websocket.js";const u=({callState:e,callDuration:t,formatDuration:c,isMuted:a,isConnected:r,otherUserName:i,otherUserAvatar:d,onMuteToggle:u,onEndCall:p})=>{const m=o.useMemo(()=>{if(!i)return"–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª";try{return decodeURIComponent(i)}catch(e){return i}},[i]),g=o.useMemo(()=>{if(!d)return null;try{return decodeURIComponent(d)}catch(e){return d}},[d]),h=e=>{if(!e||""===e.trim())return!1;return!["/default-avatar","default-avatar.png","default-avatar.jpg"].some(o=>e.includes(o))},v=o.useMemo(()=>l(m.charCodeAt(0)||0),[m]),w=o.useMemo(()=>s(m),[m]);return n.jsxs("div",{className:"call-window-container",children:[n.jsxs("div",{className:"call-window-background",children:[n.jsx("div",{className:"call-window-bg-shape shape-1"}),n.jsx("div",{className:"call-window-bg-shape shape-2"}),n.jsx("div",{className:"call-window-bg-shape shape-3"}),n.jsx("div",{className:"call-window-bg-shape shape-4"})]}),n.jsxs("div",{className:"call-window-modal",children:[n.jsxs("div",{className:`call-window-avatar ${"connected"===e?"connected":""} ${"outgoing"===e||"incoming"===e?"pulsing":""}`,children:[g&&h(g)?n.jsx("img",{src:g,alt:m,onError:e=>{e.target.style.display="none";const o=e.target.nextElementSibling;o&&(o.style.display="flex")}}):null,n.jsx("div",{className:"call-window-avatar-placeholder",style:{display:g&&h(g)?"none":"flex",backgroundColor:v},children:w}),"connected"===e&&r&&n.jsx("div",{className:"call-window-avatar-ring"})]}),n.jsxs("div",{className:"call-window-status",children:[n.jsxs("div",{className:"call-window-title",children:["outgoing"===e&&"–û–±–∞–∂–¥–∞–Ω–µ...","incoming"===e&&"–í—Ö–æ–¥—è—â–æ –æ–±–∞–∂–¥–∞–Ω–µ","connected"===e&&n.jsxs(n.Fragment,{children:["–í —Ä–∞–∑–≥–æ–≤–æ—Ä ",m&&`—Å ${m}`]}),"rejected"===e&&"–û–±–∞–∂–¥–∞–Ω–µ—Ç–æ –µ –æ—Ç—Ö–≤—ä—Ä–ª–µ–Ω–æ"]}),n.jsx("div",{className:"call-window-subtitle",children:"connected"===e&&r?c(t):"rejected"===e?"–ó–∞—Ç–≤–∞—Ä—è–Ω–µ...":m}),("incoming"===e||"outgoing"===e)&&n.jsxs("div",{className:"call-window-calling-animation",children:[n.jsxs("div",{className:"call-window-ripple-container",children:[n.jsx("div",{className:"call-window-ripple ripple-1"}),n.jsx("div",{className:"call-window-ripple ripple-2"}),n.jsx("div",{className:"call-window-ripple ripple-3"}),n.jsx("div",{className:"call-window-ripple ripple-4"})]}),n.jsx("div",{className:"call-window-glow-core",children:n.jsx("div",{className:"call-window-glow-inner"})}),n.jsxs("div",{className:"call-window-particles",children:[n.jsx("div",{className:"particle particle-1"}),n.jsx("div",{className:"particle particle-2"}),n.jsx("div",{className:"particle particle-3"}),n.jsx("div",{className:"particle particle-4"}),n.jsx("div",{className:"particle particle-5"}),n.jsx("div",{className:"particle particle-6"})]})]}),"rejected"===e&&n.jsxs("div",{className:"call-window-calling-animation call-window-rejection-animation",children:[n.jsxs("div",{className:"call-window-ripple-container",children:[n.jsx("div",{className:"call-window-ripple ripple-1 rejection-ripple"}),n.jsx("div",{className:"call-window-ripple ripple-2 rejection-ripple"}),n.jsx("div",{className:"call-window-ripple ripple-3 rejection-ripple"}),n.jsx("div",{className:"call-window-ripple ripple-4 rejection-ripple"})]}),n.jsx("div",{className:"call-window-glow-core rejection-glow",children:n.jsx("div",{className:"call-window-glow-inner rejection-glow-inner"})}),n.jsxs("div",{className:"call-window-particles rejection-particles",children:[n.jsx("div",{className:"particle particle-1 rejection-particle"}),n.jsx("div",{className:"particle particle-2 rejection-particle"}),n.jsx("div",{className:"particle particle-3 rejection-particle"}),n.jsx("div",{className:"particle particle-4 rejection-particle"}),n.jsx("div",{className:"particle particle-5 rejection-particle"}),n.jsx("div",{className:"particle particle-6 rejection-particle"})]})]}),"connected"===e&&!r&&n.jsx("div",{className:"call-window-connecting",children:"–°–≤—ä—Ä–∑–≤–∞–Ω–µ..."})]}),n.jsxs("div",{className:"call-window-actions",children:["connected"===e&&n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"call-window-btn-mute "+(a?"muted":""),onClick:u,title:a?"–í–∫–ª—é—á–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞":"–ò–∑–∫–ª—é—á–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞",children:a?n.jsx("i",{className:"bi bi-mic-mute muted-icon"}):n.jsx("i",{className:"bi bi-mic active-icon"})}),n.jsx("button",{className:"call-window-btn-end",onClick:p,title:"–ó–∞—Ç–≤–æ—Ä–∏ –æ–±–∞–∂–¥–∞–Ω–µ—Ç–æ",children:n.jsx("i",{className:"bi bi-telephone end-icon"})})]}),("outgoing"===e||"incoming"===e)&&n.jsx("button",{className:"call-window-btn-end",onClick:p,title:"outgoing"===e?"–û—Ç–º–µ–Ω–∏ –æ–±–∞–∂–¥–∞–Ω–µ—Ç–æ":"–û—Ç–∫–∞–∂–∏ –æ–±–∞–∂–¥–∞–Ω–µ—Ç–æ",children:n.jsx("i",{className:"bi bi-telephone end-icon"})}),"rejected"===e&&n.jsx("div",{className:"call-window-actions"})]})]})]})},p=({callData:e})=>{t.useEffect(()=>{console.log("üé¨ CallWindowApp component mounted with callState:",e.callState)},[]);const[o,c]=t.useState(e.callState),[l,s]=t.useState(0),[p,m]=t.useState(!1),[g,h]=t.useState(!1),v=t.useRef(null),w=t.useRef(null),f=t.useRef(new Map),k=t.useRef(null),b=t.useRef(null),y=t.useRef(null),E=t.useRef(null),C=t.useRef(null);t.useEffect(()=>{try{const e=localStorage.getItem("svmessenger-audio-settings");if(e){const o=JSON.parse(e);o.microphone&&(k.current=o.microphone),o.speaker&&(b.current=o.speaker)}}catch(e){}},[]);const j=t.useCallback(async()=>{var o,n,t,l;try{v.current&&v.current.isConnected&&await L();const m=new a;if(v.current=m,m.on(r.Connected,()=>{var e;console.log("‚úÖ Room connected event fired"),h(!0),c("connected"),console.log("Room connected, participants:",(null==(e=m.participants)?void 0:e.size)||0),console.log("Local participant identity:",m.localParticipant.identity),m.participants&&m.participants.size>0?(console.log("Found existing participants:",m.participants.size),m.participants.forEach((e,o)=>{e.audioTrackPublications.forEach(e=>{e.track&&(console.log("  - ‚úÖ Attaching existing track for:",o),N(e.track,o))})})):console.log("No existing participants in room - we are the first")}),m.on(r.Disconnected,()=>{h(!1)}),m.on(r.ParticipantConnected,e=>{console.log("üë§ Participant connected:",e.identity),console.log("  - Audio track publications:",e.audioTrackPublications.size),console.log("  - Video track publications:",e.videoTrackPublications.size),e.audioTrackPublications.forEach((o,n)=>{if(console.log("  - Processing audio publication:",n,{hasTrack:!!o.track,isSubscribed:o.isSubscribed,trackSid:o.trackSid,source:o.source}),o.track)console.log("  - ‚úÖ Attaching existing track for participant:",e.identity),N(o.track,e.identity);else{console.log("  - ‚è≥ Track not available yet, subscribing...");try{m.localParticipant.setSubscribed(o,!0),console.log("  - ‚úÖ Successfully requested subscription, waiting for TrackSubscribed event")}catch(t){console.error("  - ‚ùå Failed to subscribe to track:",t)}}})}),m.on(r.ParticipantDisconnected,o=>{console.log("Participant disconnected:",o.identity),T(o.identity);const n=m.localParticipant.identity;if(o.identity!==n){console.log("Other party disconnected, ending call");try{const o={eventType:"CALL_END",conversationId:e.conversationId,callerId:e.currentUserId,receiverId:e.otherUserId,roomName:e.roomName,timestamp:(new Date).toISOString()};d.sendCallSignal(o)}catch(t){console.error("Failed to send CALL_END on participant disconnect:",t)}I()}}),m.on(r.TrackSubscribed,(e,o,n)=>{e&&"audio"===e.kind?(console.log("üéµ Track subscribed event:",{kind:e.kind,participant:n.identity,trackSid:e.sid,publicationSid:o.trackSid,isMuted:e.isMuted}),N(e,n.identity)):console.log("Track subscribed but not audio:",null==e?void 0:e.kind)}),m.on(r.TrackUnsubscribed,(e,o,n)=>{"audio"===e.kind&&T(n.identity)}),console.log("üîå Connecting to LiveKit room:",e.roomName,"with token length:",(null==(o=e.token)?void 0:o.length)||0),console.log("üîå Token preview:",(null==(n=e.token)?void 0:n.substring(0,50))+"..."),await m.connect("wss://smolyanvote-nq17fbx3.livekit.cloud",e.token),console.log("‚úÖ Successfully connected to LiveKit room"),console.log("‚úÖ Room state:",{isConnected:m.isConnected,name:m.name,localParticipant:null==(t=m.localParticipant)?void 0:t.identity,participants:(null==(l=m.participants)?void 0:l.size)||0}),await new Promise(e=>setTimeout(e,300)),k.current&&w.current)try{const e=Array.from(m.localParticipant.audioTrackPublications.values());for(const n of e)n.track&&await m.localParticipant.unpublishTrack(n.track);const o=w.current.getAudioTracks();if(o.length>0){const e=o[0],n=new i(e);await m.localParticipant.publishTrack(n,{source:"microphone"}),console.log("‚úÖ Microphone published successfully from existing stream")}}catch(s){console.error("Failed to publish microphone from stream:",s);try{await m.localParticipant.setMicrophoneEnabled(!0),console.log("‚úÖ Enabled default microphone as fallback")}catch(u){console.error("Failed to enable default microphone:",u)}}else if(k.current)try{const e=k.current,o={audio:!e||{deviceId:{ideal:e}},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},n=await navigator.mediaDevices.getUserMedia(o);w.current=n;const t=n.getAudioTracks();if(t.length>0){const e=t[0],o=new i(e);await m.localParticipant.publishTrack(o,{source:"microphone"}),console.log("‚úÖ Microphone published successfully from new stream")}}catch(p){console.error("Failed to get and publish microphone:",p);try{await m.localParticipant.setMicrophoneEnabled(!0),console.log("‚úÖ Enabled default microphone as fallback")}catch(u){console.error("Failed to enable default microphone:",u)}}else try{await m.localParticipant.setMicrophoneEnabled(!0),console.log("‚úÖ Enabled default microphone (no selection)")}catch(p){console.error("Failed to enable default microphone:",p)}}catch(p){if(console.error("Failed to connect to LiveKit:",p),h(!1),c("connected"),v.current){try{await v.current.disconnect()}catch(m){console.error("Failed to disconnect on error:",m)}v.current=null}}},[e.token]);t.useCallback(async()=>{var e,o;if(console.log("üé§ publishMicrophone called"),console.log("  - roomRef.current:",!!v.current),console.log("  - isConnected:",null==(e=v.current)?void 0:e.isConnected),console.log("  - room name:",null==(o=v.current)?void 0:o.name),v.current)if(v.current.isConnected)try{const e=Array.from(v.current.localParticipant.audioTrackPublications.values());for(const n of e)n.track&&await v.current.localParticipant.unpublishTrack(n.track);const o=k.current,a={audio:!o||{deviceId:{ideal:o}},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0};let r;try{r=await navigator.mediaDevices.getUserMedia(a),console.log("Got user media stream with",r.getAudioTracks().length,"audio tracks")}catch(n){console.warn("Failed to get user media with device:",n);try{r=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),console.log("Got fallback user media stream")}catch(t){console.error("Failed to get fallback user media:",t);try{await v.current.localParticipant.setMicrophoneEnabled(!0),console.log("Enabled default microphone via setMicrophoneEnabled")}catch(c){console.error("Failed to enable default microphone:",c)}return}}w.current=r;const l=r.getAudioTracks();if(l.length>0){const e=l[0];console.log("Creating LocalAudioTrack from MediaStreamTrack:",e.id);const o=new i(e);await v.current.localParticipant.publishTrack(o,{source:"microphone"}),console.log("‚úÖ Microphone published successfully!"),console.log("  - Track SID:",o.sid),console.log("  - Track kind:",o.kind),console.log("  - Track enabled:",o.isEnabled),console.log("  - Track muted:",o.isMuted),console.log("  - Local participant publications:",v.current.localParticipant.audioTrackPublications.size)}else{console.error("No audio tracks in stream");try{await v.current.localParticipant.setMicrophoneEnabled(!0),console.log("Enabled default microphone as fallback")}catch(t){console.error("Failed to enable default microphone:",t)}}}catch(n){console.error("Failed to publish microphone:",n);try{await v.current.localParticipant.setMicrophoneEnabled(!0),console.log("Enabled default microphone after error")}catch(t){console.error("Failed to enable default microphone:",t)}}else console.error("‚ùå Cannot publish microphone: room not connected",{isConnected:v.current.isConnected,roomName:v.current.name});else console.error("‚ùå Cannot publish microphone: roomRef.current is null")},[]);const N=t.useCallback((e,o)=>{try{console.log("üîä Attaching remote audio track:",{participant:o,trackSid:e.sid,trackKind:e.kind,isMuted:e.isMuted,isEnabled:e.isEnabled});const t=f.current.get(o);if(t){console.log("Removing existing audio element for:",o);try{e.detach(t)}catch(n){console.warn("Error detaching old track:",n)}t.pause(),t.srcObject=null,t.remove()}const c=document.createElement("audio");c.autoplay=!0,c.playsInline=!0,c.volume=1,b.current&&"setSinkId"in HTMLAudioElement.prototype?c.setSinkId(b.current).then(()=>{console.log("Speaker set to:",b.current)}).catch(e=>{console.warn("Failed to set speaker:",e)}):console.log("Using default speaker (setSinkId not available or no speaker selected)"),e.attach(c),f.current.set(o,c),console.log("‚úÖ Remote audio track attached for participant:",o),console.log("Audio element properties:",{autoplay:c.autoplay,volume:c.volume,paused:c.paused,readyState:c.readyState,src:c.src}),c.addEventListener("error",e=>{console.error("‚ùå Remote audio error:",e,{error:c.error,networkState:c.networkState,readyState:c.readyState})}),c.addEventListener("loadedmetadata",()=>{console.log("üìä Remote audio metadata loaded for:",o,{duration:c.duration,readyState:c.readyState})}),c.addEventListener("canplay",()=>{console.log("‚ñ∂Ô∏è Remote audio can play for:",o)}),c.addEventListener("playing",()=>{console.log("üéµ Remote audio is playing for:",o)});const a=c.play();void 0!==a&&a.then(()=>{console.log("‚úÖ Remote audio playing for:",o)}).catch(e=>{console.warn("‚ö†Ô∏è Autoplay prevented for remote audio:",e);const o=()=>{c.play().then(()=>{console.log("‚úÖ Remote audio started after user interaction")}).catch(e=>{console.error("‚ùå Failed to play after user interaction:",e)})};document.addEventListener("click",o,{once:!0}),document.addEventListener("touchstart",o,{once:!0})})}catch(t){console.error("‚ùå Error attaching remote audio track:",t)}},[]),T=t.useCallback(e=>{const o=f.current.get(e);o&&(o.pause(),o.srcObject=null,o.remove(),f.current.delete(e))},[]),x=t.useCallback(async e=>{k.current=e,w.current&&(w.current.getTracks().forEach(e=>e.stop()),w.current=null);try{const o=await navigator.mediaDevices.getUserMedia({audio:!e||{deviceId:{ideal:e}},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0});if(w.current=o,v.current&&v.current.isConnected){const e=Array.from(v.current.localParticipant.audioTrackPublications.values());for(const o of e)o.track&&await v.current.localParticipant.unpublishTrack(o.track);const n=o.getAudioTracks();if(n.length>0){const e=n[0],o=new i(e);await v.current.localParticipant.publishTrack(o,{source:"microphone"})}}}catch(o){console.error("Failed to set microphone:",o)}},[]),S=t.useCallback(async e=>{b.current=e,"setSinkId"in HTMLAudioElement.prototype&&f.current.forEach(o=>{o.setSinkId(e).catch(()=>{})})},[]),L=t.useCallback(async()=>{w.current&&(w.current.getTracks().forEach(e=>e.stop()),w.current=null),f.current.forEach(e=>{e.pause(),e.srcObject=null,e.remove()}),f.current.clear(),v.current&&(await v.current.disconnect(),v.current=null),h(!1)},[]),I=t.useCallback(async()=>{console.log("üìû handleEndCall called"),console.log("  - Current callState:",o),console.log("  - Current isConnected:",g),console.log("  - Conversation ID:",e.conversationId),C.current&&(C.current.pause(),C.current.currentTime=0,C.current=null);try{const o={eventType:"CALL_END",conversationId:e.conversationId,callerId:e.currentUserId,receiverId:e.otherUserId,roomName:e.roomName,timestamp:(new Date).toISOString()};console.log("üì§ Sending CALL_END signal:",o),d.sendCallSignal(o),console.log("‚úÖ CALL_END signal sent from popup")}catch(n){console.error("‚ùå Failed to send CALL_END signal:",n)}await L(),y.current&&y.current.postMessage({type:"CALL_ENDED_FROM_POPUP",data:{conversationId:e.conversationId}}),console.log("üö™ Closing popup window"),window.close()},[e,L,o,g]),A=t.useCallback(async()=>{const e=!p;if(m(e),v.current&&v.current.isConnected)try{const o=Array.from(v.current.localParticipant.audioTrackPublications.values());if(e){for(const e of o)e.track&&e.track.setEnabled(!1);await v.current.localParticipant.setMicrophoneEnabled(!1),console.log("üîá Microphone muted")}else{for(const e of o)e.track&&e.track.setEnabled(!0);await v.current.localParticipant.setMicrophoneEnabled(!0),console.log("üîä Microphone unmuted")}}catch(o){console.error("‚ùå Error toggling microphone:",o)}y.current&&y.current.postMessage({type:"MUTE_TOGGLED",data:{isMuted:e}})},[p]);t.useEffect(()=>{const e=async e=>{try{const o=new Audio(e);o.loop=!0,o.volume=.7,o.preload="auto";let n=o.play();void 0!==n&&(await n,C.current=o,console.log("‚úÖ Call sound started:",e))}catch(n){if(console.warn("‚ö†Ô∏è Failed to play call sound (autoplay blocked?):",n),"incoming"===o){const o=async()=>{try{const n=new Audio(e);n.loop=!0,n.volume=.7,await n.play(),C.current=n,console.log("‚úÖ Call sound started after user interaction"),document.removeEventListener("click",o),document.removeEventListener("touchstart",o),window.removeEventListener("focus",o)}catch(n){console.error("‚ùå Failed to play sound even after interaction:",n)}};document.addEventListener("click",o,{once:!0}),document.addEventListener("touchstart",o,{once:!0}),window.addEventListener("focus",o,{once:!0}),document.hasFocus()&&setTimeout(()=>o(),100)}}};return"outgoing"===o?e("/svmessenger/sounds/OutCall.mp3"):"incoming"===o?(window.focus&&window.focus(),e("/svmessenger/sounds/IncomingCall.mp3")):("connected"===o&&C.current||"rejected"===o&&C.current)&&(C.current.pause(),C.current.currentTime=0,C.current=null),()=>{C.current&&(C.current.pause(),C.current.currentTime=0,C.current=null)}},[o]),t.useEffect(()=>(console.log("üîÑ useEffect for callState changed:",o),"connected"===o?(console.log('‚úÖ callState is "connected", connecting to LiveKit...'),j().catch(e=>{console.error("‚ùå Failed to connect to LiveKit in useEffect:",e)})):console.log('‚è≥ callState is not "connected", waiting... (current:',o,")"),()=>{console.log("üßπ Cleaning up LiveKit connection"),L()}),[o,j,L]),t.useEffect(()=>("connected"===o&&g?E.current=setInterval(()=>{s(e=>e+1)},1e3):(E.current&&(clearInterval(E.current),E.current=null),s(0)),()=>{E.current&&clearInterval(E.current)}),[o,g]),t.useEffect(()=>(d.connect({onCallSignal:o=>{"CALL_END"===o.eventType?(console.log("üìû CALL_END received in popup:",o),o.conversationId===e.conversationId&&(console.log("üìû CALL_END matches our call, showing rejection animation..."),c("rejected"),C.current&&(C.current.pause(),C.current.currentTime=0,C.current=null),setTimeout(()=>{I()},3e3))):"CALL_REJECT"===o.eventType&&(console.log("üìû CALL_REJECT received in popup:",o),o.conversationId===e.conversationId&&(console.log("üìû CALL_REJECT matches our call, showing rejection animation..."),c("rejected"),C.current&&(C.current.pause(),C.current.currentTime=0,C.current=null),setTimeout(()=>{I()},3e3)))},onConnect:()=>{console.log("WebSocket connected in popup")},onDisconnect:()=>{console.log("WebSocket disconnected in popup")},onError:e=>{console.error("WebSocket error in popup:",e)}}),()=>{d.disconnect()}),[e.conversationId,I]),t.useEffect(()=>(y.current=new BroadcastChannel("svmessenger-call"),y.current.onmessage=e=>{const{type:o,data:n}=e.data;switch(o){case"CALL_ENDED":console.log("üìû CALL_ENDED received via BroadcastChannel"),c("rejected"),C.current&&(C.current.pause(),C.current.currentTime=0,C.current=null),setTimeout(()=>{I()},3e3);break;case"CALL_REJECTED":console.log("üìû CALL_REJECTED received via BroadcastChannel"),c("rejected"),C.current&&(C.current.pause(),C.current.currentTime=0,C.current=null),setTimeout(()=>{I()},3e3);break;case"CALL_ACCEPTED":console.log("‚úÖ CALL_ACCEPTED received via BroadcastChannel, changing callState to connected"),c("connected");break;case"MUTE_TOGGLED":m(n.isMuted);break;case"DEVICE_CHANGED":n.microphone&&(k.current=n.microphone,x(n.microphone)),n.speaker&&(b.current=n.speaker,S(n.speaker))}},()=>{y.current&&y.current.close()}),[I,x,S]),t.useEffect(()=>{const e=()=>{L()};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[L]);return n.jsx(u,{callState:o,callDuration:l,formatDuration:e=>{const o=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},isMuted:p,isConnected:g,otherUserName:e.otherUserName,otherUserAvatar:e.otherUserAvatar,onMuteToggle:A,onEndCall:I})};console.log("üöÄ Call window popup opened");const m=new URLSearchParams(window.location.search),g={token:m.get("token"),roomName:m.get("roomName"),conversationId:m.get("conversationId"),otherUserId:m.get("otherUserId"),otherUserName:m.get("otherUserName"),otherUserAvatar:m.get("otherUserAvatar"),currentUserId:m.get("currentUserId"),currentUserName:m.get("currentUserName"),currentUserAvatar:m.get("currentUserAvatar"),callType:m.get("callType")||"voice",callState:m.get("callState")||"outgoing"};if(console.log("üìû Call window data:",{hasToken:!!g.token,tokenLength:(null==(e=g.token)?void 0:e.length)||0,roomName:g.roomName,conversationId:g.conversationId,callState:g.callState,otherUserId:g.otherUserId,currentUserId:g.currentUserId}),g.token&&g.roomName&&g.conversationId){console.log("‚úÖ All required data present, mounting React app");const e=document.getElementById("call-window-root");if(e){c(e).render(n.jsx(p,{callData:g})),console.log("‚úÖ React app mounted")}else console.error("‚ùå Container element not found!")}else console.error("‚ùå Missing required call data:",{hasToken:!!g.token,hasRoomName:!!g.roomName,hasConversationId:!!g.conversationId}),document.body.innerHTML='\n        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column; gap: 20px;">\n            <h2>–ì—Ä–µ—à–∫–∞</h2>\n            <p>–õ–∏–ø—Å–≤–∞—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏ –¥–∞–Ω–Ω–∏ –∑–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞.</p>\n            <button onclick="window.close()" style="padding: 10px 20px; cursor: pointer;">–ó–∞—Ç–≤–æ—Ä–∏</button>\n        </div>\n    ';
