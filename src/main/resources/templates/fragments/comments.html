<!-- @thymesVar id="eventId" type="java.lang.Long" -->
<!-- @thymesVar id="comments" type="java.util.List<smolyanVote.smolyanVote.models.CommentsEntity>" -->
<!-- @thymesVar id="currentUser" type="smolyanVote.smolyanVote.models.UserEntity" -->
<!-- @thymesVar id="comment" type="smolyanVote.smolyanVote.models.CommentsEntity" -->
<!-- @thymesVar id="reply" type="smolyanVote.smolyanVote.models.CommentsEntity" -->

<div th:fragment="comments(eventId, comments, currentUser)">
    <div class="container mt-5" id="comments-section" th:data-event-id="${eventId}">
        <h3 class="mb-4">–ö–æ–º–µ–Ω—Ç–∞—Ä–∏</h3>

        <!-- –û—Å–Ω–æ–≤–Ω–∞ —Ñ–æ—Ä–º–∞ –∑–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä -->
        <form id="comment-form" action="javascript:void(0);" method="post">
            <input type="hidden" name="eventId" th:value="${eventId}" />
            <input type="hidden" name="author" th:value="${currentUser.getUsername()}" />
            <input type="hidden" name="text" id="comment-hidden" />

            <div class="mb-3 d-flex align-items-center comment-header">
                <img th:src="${currentUser.getImageUrl()}" alt="–°–Ω–∏–º–∫–∞ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è"
                     class="user-img rounded-circle me-3" />
                <div class="comment-author" th:text="${currentUser.getUsername()}">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</div>
            </div>

            <button type="submit" class="btn btn-primary">–ü—É–±–ª–∏–∫—É–≤–∞–π</button>

        </form>
        <!-- Quill —Ä–µ–¥–∞–∫—Ç–æ—Ä—ä—Ç -->
        <div id="editor-container" style="height: 150px;"></div>

        <hr/>
        <!-- –°–ø–∏—Å—ä–∫ —Å –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ -->
        <div id="comment-list">
            <div th:each="comment : ${comments}" th:id="'comment-' + ${comment.id}" class="comment-box">
                <div class="comment-header mb-2">
                    <img th:src="${comment.getAuthorImage()}" alt="–°–Ω–∏–º–∫–∞"
                         class="rounded-circle me-3 comment-img">
                    <div class="comment-author" th:text="${comment.author}">–ê–≤—Ç–æ—Ä</div>
                    <span th:text="${comment.getCreatedAt() != null ? #dates.format(comment.getCreatedAt(), 'dd.MM.yyyy / HH:mm') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –¥–∞—Ç–∞'}">01.01.2025</span>
                </div>
                <div class="comment-text" th:utext="${comment.text}">–¢–µ–∫—Å—Ç</div>

                <!-- –ë—É—Ç–æ–Ω –∑–∞ –æ—Ç–≥–æ–≤–æ—Ä -->
                <button class="btn btn-sm btn-outline-secondary reply-btn" th:data-id="${comment.id}">–ù–∞–ø–∏—à–∏ –æ—Ç–≥–æ–≤–æ—Ä</button>

                <!-- Like/Dislike —Å–µ–∫—Ü–∏—è -->
                <div class="mt-2 d-flex align-items-center gap-3">
                    <button class="btn btn-sm like-btn" th:data-id="${comment.id}" data-type="like">
                        üëç <span th:text="${comment.getLikeCount()}">0</span>
                    </button>
                    <button class="btn btn-sm dislike-btn" th:data-id="${comment.id}" data-type="dislike">
                        üëé <span th:text="${comment.getUnlikeCount()}">0</span>
                    </button>
                </div>


                <!-- –§–æ—Ä–º–∞ –∑–∞ –æ—Ç–≥–æ–≤–æ—Ä -->
                <form class="reply-form mt-2 d-none" th:id="'reply-form-' + ${comment.id}" data-bound="false">
                    <input type="hidden" name="eventId" th:value="${eventId}" />
                    <input type="hidden" name="parentId" th:value="${comment.id}" />
                    <input type="hidden" name="author" th:value="${currentUser.getUsername()}" />

                    <div class="mb-2">
                        <textarea name="text" placeholder="–û—Ç–≥–æ–≤–æ—Ä..." class="form-control form-control-sm" rows="2" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-sm btn-primary">–ò–∑–ø—Ä–∞—Ç–∏</button>
                </form>

                <!-- –ü–æ–¥–∫–æ–º–µ–Ω—Ç–∞—Ä–∏ -->
                <div class="replies ms-4 mt-3" th:id="'replies-container-' + ${comment.id}">
                    <!-- –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ —Å–∫—Ä–∏–≤–∞–º–µ –≤—Å–∏—á–∫–∏ –ø–æ–¥–∫–æ–º–µ–Ω—Ç–∞—Ä–∏ -->
                    <div class="replies-list" style="display: none;">
                        <div th:each="reply, iterStat : ${comment.replies}" class="reply-box">
                            <img th:src="${reply.getAuthorImage()}" alt="–°–Ω–∏–º–∫–∞"
                                 class="rounded-circle me-2 mt-1 reply-img">
                            <div>
                                <div class="comment-author" th:text="${reply.author}">–ê–≤—Ç–æ—Ä</div>
                                <div class="reply-text" th:utext="${reply.text}">–¢–µ–∫—Å—Ç</div>
                            </div>
                            <span th:text="${reply.getCreatedAt() != null ? #dates.format(reply.getCreatedAt(), 'dd.MM.yyyy / HH:mm') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –¥–∞—Ç–∞'}">01.01.2025</span>
                            <div class="mt-1 d-flex align-items-center gap-2 ms-4">
                                <button class="btn btn-sm like-btn" th:data-id="${reply.id}" data-type="like">
                                    üëç <span th:text="${reply.getLikeCount()}">0</span>
                                </button>
                                <button class="btn btn-sm dislike-btn" th:data-id="${reply.id}" data-type="dislike">
                                    üëé <span th:text="${reply.getUnlikeCount()}">0</span>
                                </button>
                            </div>

                        </div>
                    </div>
                    <!-- –ë—É—Ç–æ–Ω –∑–∞ —Ä–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ -->
                    <div style="text-align: center; margin: 1px;">
                        <button
                                th:if="${#lists.size(comment.replies) > 0}"
                                th:text="'–ü–æ–∫–∞–∂–∏ –≤—Å–∏—á–∫–∏ ( ' + ${#lists.size(comment.replies)} + ' ) –æ—Ç–≥–æ–≤–æ—Ä–∏'"
                                class="show-replies-btn"
                                style="display: none; background: none; border: none; color: #4d4d4d; padding: 0; font-size: 0.9rem; cursor: pointer; text-decoration: underline;">
                            –ü–æ–∫–∞–∂–∏ –≤—Å–∏—á–∫–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏
                        </button>
                    </div>


                </div>


            </div>
        </div>
    </div>
</div>
