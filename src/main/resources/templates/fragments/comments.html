<!-- fragments/comments.html -->
<!-- @thymesVar id="comment" type="smolyanVote.smolyanVote.models.CommentsEntity" -->
<!-- fragments/comments.html -->


<div th:fragment="comments(eventId, comments, currentUser)">
    <div class="container mt-5" id="comments-section" th:data-event-id="${eventId}">
        <h3>Коментари</h3>

        <!-- Основна форма -->
        <form id="comment-form" action="javascript:void(0);" method="post">
            <input type="hidden" name="eventId" th:value="${eventId}" />
            <input type="hidden" name="author" th:value="${currentUser.getUsername()}" /> <!-- Скритото поле за автор -->

            <!-- Показване на снимка на потребителя и името му -->
            <div class="mb-3 d-flex align-items-center">
                <img th:src="${currentUser.getImageUrl()}" alt="Снимка на потребителя" class="user-img rounded-circle me-3" style="width: 40px; height: 40px; object-fit: cover;" />
                <span th:text="${currentUser.getUsername()}" class="user-name">Потребител</span>
            </div>

            <!-- Поле за коментар -->
            <div class="mb-3">
                <textarea name="text" placeholder="Вашият коментар" class="form-control" required></textarea>
            </div>

            <button type="submit" class="btn btn-primary">Публикувай</button>
        </form>

        <hr/>

        <!-- Списък с коментари -->
        <div id="comment-list">
            <div th:each="comment : ${comments}" class="mb-3 p-3 bg-light rounded" th:id="'comment-' + ${comment.id}">
                <p th:utext="${comment.text}">Текст</p>

                <!-- Бутон за отговор -->
                <button class="btn btn-sm btn-outline-secondary reply-btn" th:data-id="${comment.id}">Отговор</button>

                <!-- Форма за отговор -->
                <form class="reply-form mt-2 d-none"
                      th:id="'reply-form-' + ${comment.id}">
                    <input type="hidden" name="eventId" th:value="${eventId}" />
                    <input type="hidden" name="parentId" th:value="${comment.id}" />
                    <input type="hidden" name="author" th:value="${#authentication.name}" />

                    <div class="mb-2">
                        <textarea name="text" placeholder="Отговор..." class="form-control form-control-sm" rows="2" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-sm btn-primary">Изпрати</button>
                </form>

                <!-- Подкоментари -->
                <div class="replies ms-4 mt-3" th:id="'replies-container-' + ${comment.id}">
                    <div th:each="reply : ${comment.replies}" class="border-start ps-3 mb-2">
                        <strong th:text="${reply.author}">Автор</strong>
                        <p th:utext="${reply.text}">Текст</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

