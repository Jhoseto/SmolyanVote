<div th:fragment="bottomStyles">
    <!-- ПЪРВО authentication check -->
    <script th:inline="javascript">
        window.isAuthenticated = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;
    </script>

    <script src="/js/utils/avatarUtils.js"></script>
    <script src="/js/footer.js"></script>

    <!-- Проста универсална инициализация за аватари -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                // Стандартна avatarUtils инициализация
                if (window.avatarUtils) {
                    window.avatarUtils.updateAll();
                }
            }, 300);
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- ⭐  SockJS за WebSocket -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.2/dist/sockjs.min.js"></script>

    <!-- CSRF Protection (преди notifications) -->
    <script src="/js/utils/csrf.js"></script>

    <!-- Notifications СЛЕД SockJS и CSRF -->
    <script src="/js/notifications.js"></script>

    <!-- Mobile Menu -->
    <script src="/js/mobile-menu.js"></script>
    
    <!-- SVMessenger Widget (винаги на последно място) -->
    <div th:replace="~{fragments/svMessengerWidget :: svMessengerWidget}"></div>
</div>