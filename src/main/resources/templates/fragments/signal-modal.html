<!-- Modern Signal Modal Fragment -->
<div th:fragment="signal-modal"
     xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
     class="signal-modal" id="signalModal">
    <div class="modal-overlay" onclick="closeSignalModal()"></div>

    <div class="modal-container">
        <!-- Compact Header -->
        <div class="modal-header">
            <div class="header-badges">
                <span class="category-badge" id="modalCategoryBadge">
                    <i id="modalCategoryIcon" class="bi bi-circle"></i>
                    <span id="modalCategoryName">Категория</span>
                </span>
                <span class="expiration-badge" id="modalExpirationBadge">
                    <i id="modalExpirationIcon" class="bi bi-clock"></i>
                    <span id="modalExpirationName">Период</span>
                </span>
            </div>

            <div class="header-actions">
                <!-- Three dots menu -->
                <div class="dropdown-menu-container" sec:authorize="isAuthenticated()">
                    <button class="three-dots-btn" id="threeDotsBtn" onclick="toggleThreeDotsMenu()">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <div class="three-dots-menu" id="threeDotsMenu">
                        <button class="menu-item" onclick="editSignal()" id="editSignalBtn">
                            <i class="bi bi-pencil"></i>
                            <span>Редактирай</span>
                        </button>
                        <button class="menu-item delete-item" onclick="deleteSignal()" id="deleteSignalBtn">
                            <i class="bi bi-trash"></i>
                            <span>Изтрий</span>
                        </button>
                    </div>
                </div>

                <!-- Close button -->
                <button class="modal-close" onclick="closeSignalModal()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
            <!-- Hero Section -->
            <div class="hero-section">
                <h2 class="signal-title" id="modalSignalTitle">Заглавие на сигнала</h2>
                <div class="signal-meta">
                    <div class="author-info">
                        <div class="author-avatar" id="modalAuthorAvatar"></div>
                        <span class="author-name" id="modalAuthorName">Автор</span>
                    </div>
                    <span class="relative-time" id="modalRelativeTime">преди малко</span>
                </div>
            </div>

            <!-- Description -->
            <div class="description-section">
                <p class="signal-description" id="modalSignalDescription">
                    Описание на сигнала ще се появи тук...
                </p>
            </div>

            <!-- Image Section -->
            <div class="image-section" id="modalImageSection" style="display: none;">
                <div class="signal-image-container">
                    <img class="signal-image" id="modalSignalImage" src="" alt="Снимка на сигнала" onclick="openImageLightbox()">
                    <div class="image-overlay">
                        <i class="bi bi-arrows-fullscreen"></i>
                    </div>
                </div>
            </div>

            <!-- Reactions Bar -->
            <div class="reactions-section">
                <div class="reaction-item">
                    <button class="reaction-btn" id="likeBtn" onclick="toggleLike()">
                        <i class="bi bi-heart"></i>
                        <span id="likesCount">0</span>
                    </button>
                </div>
                <div class="reaction-item">
                    <i class="bi bi-eye"></i>
                    <span id="viewsCount">0</span>
                    <span class="reaction-label">прегледа</span>
                </div>
            </div>

            <!-- Action Button -->
            <div class="action-section">
                <button class="primary-action-btn" onclick="centerMapOnSignal()">
                    <i class="bi bi-geo-alt"></i>
                    <span>Покажи на картата</span>
                </button>
            </div>

            <!-- Comments Section -->
            <div class="comments-section">
                <!-- Comments Toggle Header -->
                <div class="comments-toggle-header">
                    <button class="comments-toggle-btn" id="commentsToggleBtn">
                        <i class="bi bi-chevron-down"></i>
                        <span>Коментари</span>
                        <span class="comments-count" id="commentsCount">(0)</span>
                    </button>
                </div>

                <!-- Comments Container -->
                <div class="comments-container" id="commentsContainer">
                    <div th:replace="~{fragments/commentsSection :: commentsSection}"></div>
                </div>
            </div>

            <!-- Footer with detailed info -->
            <div class="modal-footer">
                <span class="detailed-time" id="modalDetailedTime">Създаден на 01.01.2025 в 12:00</span>
            </div>
        </div>
    </div>

    <!-- Image Lightbox -->
    <div class="image-lightbox" id="imageLightbox" style="display: none;">
        <div class="lightbox-container">
            <img class="lightbox-image" id="lightboxImage" src="" alt="Снимка на сигнала">
            <button class="lightbox-close" onclick="closeImageLightbox()">
                <i class="bi bi-x"></i>
            </button>
        </div>
    </div>
</div>