<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<!-- SVMessenger Widget Fragment -->
<div th:fragment="svMessengerWidget">
    
    <!-- React root element -->
    <div id="svmessenger-root"></div>
    
    <!-- Pass user data to React (only if authenticated) -->
    <script sec:authorize="isAuthenticated()" th:inline="javascript" th:with="currentUser=${@userServiceImpl.getCurrentUser()}">
        window.SVMESSENGER_USER_DATA = {
            id: /*[[${currentUser.id}]]*/ null,
            username: /*[[${currentUser.username}]]*/ '',
            email: /*[[${currentUser.email}]]*/ '',
            imageUrl: /*[[${currentUser.imageUrl}]]*/ '',
            isAuthenticated: true
        };
        
        // CSRF Token for API requests
        window.SVMESSENGER_CSRF = {
            token: /*[[${_csrf.token}]]*/ '',
            headerName: /*[[${_csrf.headerName}]]*/ 'X-XSRF-TOKEN'
        };
    </script>
    
    <!-- For non-authenticated users -->
    <script sec:authorize="!isAuthenticated()">
        window.SVMESSENGER_USER_DATA = {
            isAuthenticated: false
        };
    </script>
    
    <!-- React bundle (compiled from vite) -->
    <script type="module" th:src="@{/svmessenger/svmessenger.js}"></script>
</div>

</html>
