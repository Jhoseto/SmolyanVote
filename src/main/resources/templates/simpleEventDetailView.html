<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!-- SEO -->
    <meta name="title" th:content="${eventDetail.title != null and eventDetail.title.length() > 0 ? (eventDetail.title.length() > 160 ? eventDetail.title.substring(0, 160) : eventDetail.title) : 'Детайли за събитие'}" />
    <meta name="description" th:content="${eventDetail.description != null and eventDetail.description.length() > 0 ? (eventDetail.description.length() > 160 ? eventDetail.description.substring(0, 160) : eventDetail.description) : 'Детайли за събитие'}" />
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <title>Детайли за събитие</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <div th:replace="~{fragments/topHtmlStyles :: navbarStyles}"></div>
    <link rel="stylesheet" href="/css/simpleEventDetailView.css">
    <link rel="stylesheet" href="/css/comments.css">
</head>
<body>

<!-- Навигация -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Main Content -->
<main class="main-wrapper">
    <div class="content-container">

        <!-- Event Header Card -->
        <div class="event-header-card">
            <!-- Event Type Badge -->
            <div class= "bi-pencil-square2">
                <span class="badge-text">Опростен вид събитие</span>
            </div>

            <div class="event-meta">
                <div class="creator-section">
                    <a th:href="@{'/user/' + ${eventDetail.creator.username}}" class="creator-link">
                        <img class="creator-avatar" th:src="${eventDetail.creator.imageUrl}" alt="Създател"/>
                        <div class="creator-info">
                            <span class="creator-label">Автор</span>
                            <span class="creator-name" th:text="${eventDetail.creator.username}">Име на създателя</span>
                        </div>
                    </a>
                </div>

                <div class="event-stats">
                    <div class="stat-item">
                        <span class="stat-label">ID</span>
                        <span class="stat-value" th:text="${eventDetail.id}">#12345</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Дата</span>
                        <span class="stat-value" th:text="${#dates.format(eventDetail.createdAt, 'dd.MM.yyyy')}">18.04.2025</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Локация</span>
                        <span class="stat-value" th:text="${eventDetail.location != null ? eventDetail.location.toBG() : 'Няма'}">Няма</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Гласове</span>
                        <span class="stat-value stat-highlight" th:text="${eventDetail.totalVotes}">0</span>
                    </div>
                </div>
            </div>

            <h1 class="event-title" th:text="${eventDetail.title}">Заглавие на събитието</h1>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">

            <!-- Left Column -->
            <div class="left-column">

                <!-- Description -->
                <div class="description-card">
                    <h3 class="card-title">Описание</h3>
                    <div class="description-content">
                        <p th:utext="${eventDetail.description.replace('\n', '<br/>')}">Тук е описанието на събитието.</p>
                    </div>
                </div>

                <!-- Gallery -->
                <div class="gallery-card" th:if="${eventDetail.images != null and !eventDetail.images.isEmpty()}">
                    <h3 class="card-title">Галерия</h3>
                    <div class="gallery-grid">
                        <img th:each="img : ${eventDetail.images}" th:src="${img}" alt="Снимка" class="gallery-img" loading="lazy"/>
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="comments-card">
                    <div class="comments-header">
                        <h3>
                            <i class="bi bi-chat-dots"></i>
                            Коментари (<span id="commentsHeaderCount">0</span>)
                        </h3>
                        <div class="comments-sort">
                            <select id="commentsSortSelect">
                                <option value="newest">Най-нови</option>
                                <option value="oldest">Най-стари</option>
                                <option value="popular">Най-популярни</option>
                                <option value="likes">Най-изчерпателни</option>
                            </select>
                        </div>
                    </div>
                    <div th:replace="~{fragments/commentsSection :: commentsSection}"></div>
                </div>

            </div>

            <!-- Right Column -->
            <div class="right-column">

                <!-- Voting Results -->
                <div class="voting-card">
                    <h3 class="card-title">Резултати</h3>

                    <div class="vote-result">
                        <div class="vote-label">
                            <span th:text="${eventDetail.positiveLabel}">За</span>
                            <span class="vote-percentage" th:text="${eventDetail.yesPercent} + '%'">0%</span>
                        </div>
                        <div class="vote-bar">
                            <div class="vote-fill positive" th:style="'width: ' + ${eventDetail.yesPercent} + '%;'"></div>
                        </div>
                        <span class="vote-count" th:text="${eventDetail.yesVotes}">0</span>
                    </div>

                    <div class="vote-result">
                        <div class="vote-label">
                            <span th:text="${eventDetail.negativeLabel}">Против</span>
                            <span class="vote-percentage" th:text="${eventDetail.noPercent} + '%'">0%</span>
                        </div>
                        <div class="vote-bar">
                            <div class="vote-fill negative" th:style="'width: ' + ${eventDetail.noPercent} + '%;'"></div>
                        </div>
                        <span class="vote-count" th:text="${eventDetail.noVotes}">0</span>
                    </div>

                    <div class="vote-result">
                        <div class="vote-label">
                            <span th:text="${eventDetail.neutralLabel}">Неутрален</span>
                            <span class="vote-percentage" th:text="${eventDetail.neutralPercent} + '%'">0%</span>
                        </div>
                        <div class="vote-bar">
                            <div class="vote-fill neutral" th:style="'width: ' + ${eventDetail.neutralPercent} + '%;'"></div>
                        </div>
                        <span class="vote-count" th:text="${eventDetail.neutralVotes}">0</span>
                    </div>
                </div>

                <!-- Voting Actions -->
                <div class="voting-actions-card" th:if="${currentUser != null}">
                    <h3 class="card-title">Вашето мнение</h3>

                    <div th:if="${userVote != null}" class="current-vote">
                        <div class="vote-status">
                            <span class="vote-status-text">Гласувахте с:</span>
                            <span class="vote-status-value" th:text="${userVote}">Неутрален</span>
                        </div>
                        <small class="vote-note">Можете да промените гласа си</small>
                    </div>

                    <div class="vote-buttons">
                        <button class="vote-btn positive" th:classappend="${userVote == eventDetail.positiveLabel} ? ' active'" data-vote="positive" th:data-vote-text="${eventDetail.positiveLabel}">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M7 10v12M15 5v20M7 10l4-7 2 1 3.5 7H15"></path>
                            </svg>
                            <span th:text="${eventDetail.positiveLabel}">За</span>
                        </button>

                        <button class="vote-btn negative" th:classappend="${userVote == eventDetail.negativeLabel} ? ' active'" data-vote="negative" th:data-vote-text="${eventDetail.negativeLabel}">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 14V2M9 19v-6M17 14l-4 7-2-1-3.5-7H9"></path>
                            </svg>
                            <span th:text="${eventDetail.negativeLabel}">Против</span>
                        </button>

                        <button class="vote-btn neutral" th:classappend="${userVote == eventDetail.neutralLabel} ? ' active'" data-vote="neutral" th:data-vote-text="${eventDetail.neutralLabel}">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M8 12h8"></path>
                            </svg>
                            <span th:text="${eventDetail.neutralLabel}">Неутрален</span>
                        </button>
                    </div>
                </div>

                <!-- Guest Prompt -->
                <div class="guest-prompt-card" th:if="${currentUser == null}">
                    <div class="prompt-content">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <h4>За да гласувате</h4>
                        <p>Трябва да влезете в профила си или да се регистрирате.</p>
                        <div class="prompt-actions">
                            <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" class="btn-primary">Вход</a>
                            <a href="/register" class="btn-secondary">Регистрация</a>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="navigation-card">
                    <a href="/mainEvents" class="nav-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                        Обратно към събития
                    </a>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Premium Modal -->
<div class="premium-modal" id="galleryModal">
    <div class="premium-modal-content">
        <div class="premium-modal-header">
            <h3>Галерия</h3>
            <button class="premium-close-btn" id="closeGalleryModal">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <div class="premium-modal-body">
            <div class="gallery-viewer">
                <div class="gallery-main">
                    <img id="galleryMainImage" alt="Основна снимка"/>
                    <div class="gallery-controls">
                        <button class="gallery-btn" id="prevImage">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M15 18l-6-6 6-6"></path>
                            </svg>
                        </button>
                        <button class="gallery-btn" id="nextImage">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 18l6-6-6-6"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="gallery-thumbnails" th:if="${eventDetail.images != null and eventDetail.images.size() > 1}">
                    <img th:each="img, iterStat : ${eventDetail.images}"
                         th:src="${img}"
                         th:alt="'Снимка ' + ${iterStat.index + 1}"
                         class="gallery-thumbnail"
                         th:classappend="${iterStat.index == 0} ? ' active'"
                         th:data-index="${iterStat.index}"/>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Vote Confirmation Modal -->
<div class="vote-confirm-modal" id="voteConfirmModal">
    <div class="vote-modal-content">
        <div class="vote-modal-header">
            <div class="vote-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"></path>
                </svg>
            </div>
            <h3>Потвърждение на глас</h3>
        </div>

        <div class="vote-modal-body">
            <div class="vote-summary">
                <div class="vote-item">
                    <span class="vote-item-label">Събитие:</span>
                    <span class="vote-item-value" th:text="${eventDetail.title}">Заглавие</span>
                </div>
                <div class="vote-item">
                    <span class="vote-item-label">Ваш избор:</span>
                    <span class="vote-item-value" id="selectedVoteText">За</span>
                </div>
            </div>

            <div class="vote-warning">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <div class="warning-text">
                    Моля, уверете се че сте направили правилния избор.
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn-cancel" id="cancelVote">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
                Отказ
            </button>
            <button type="button" class="btn-confirm" id="confirmVote">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 13l4 4L19 7"/>
                </svg>
                Потвърждавам гласа си
            </button>
        </div>
    </div>
</div>

<!-- Футър -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Scripts -->
<div th:replace="~{fragments/bottomHtmlStyles :: bottomStyles}"></div>
<script src="/js/simpleEventDetail.js"></script>
<script src="/js/commentsManager.js"></script>
<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // Инициализиране на коментарите за simpleEvent
        if (window.initCommentsManager) {
            const eventId = /*[[${eventDetail.id}]]*/ 0;
            window.commentsManager = window.initCommentsManager('simpleEvent', eventId);
        }
    });
</script>

</body>
</html>