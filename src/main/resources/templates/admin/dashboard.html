<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - SmolyanVote</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <div th:replace="~{fragments/topHtmlStyles :: navbarStyles}"></div>
    <link rel="stylesheet" href="/css/admin-dashboard.css">
    <link rel="stylesheet" href="/css/admin-activity-wall.css">
</head>
<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="admin-container">
    <div class="admin-header">
        <h1><i class="bi bi-gear-fill"></i> Admin Dashboard</h1>
        <p>SmolyanVote system</p>
        <h3><i class="bi bi-clock"></i> Last Refresh</h3>
        <p>Updated: <span class="last-refresh">--</span></p>
        <button id="refresh-btn" class="btn btn-outline-success btn-sm">
            <i class="bi bi-arrow-clockwise"></i> Обнови данни
        </button>
    </div>

    <!-- ОСНОВНИ СИСТЕМНИ СТАТУСИ -->
    <div class="monitoring-section">
        <h2 class="section-header" data-toggle="system-status">
            <i class="bi bi-activity"></i> Health Status
            <i class="bi bi-chevron-down collapse-icon"></i>
        </h2>
        <div class="dashboard-grid collapsible-content" id="system-status">
            <div class="dashboard-card">
                <h3><i class="bi bi-heart-pulse"></i> Общо здраве</h3>
                <p>Status: <span id="health-status" class="status-active">--</span></p>
                <p>Uptime: <span id="uptime">--</span> мин</p>
            </div>

            <div class="dashboard-card">
                <h3><i class="bi bi-database"></i> База данни</h3>
                <p>Връзка: <span id="db-status">--</span></p>
                <p>Active connections: <strong id="db-active-connections">--</strong></p>
                <p>Pending: <strong id="db-pending-connections">--</strong></p>
            </div>

            <div class="dashboard-card">
                <h3><i class="bi bi-cloud"></i> Cloudinary</h3>
                <p>Service: <span id="cloudinary-status">--</span></p>
                <p>Cloud: <span id="cloudinary-name">--</span></p>
            </div>

            <div class="dashboard-card">
                <h3><i class="bi bi-envelope"></i> Email Service</h3>
                <p>Service: <span id="email-status">--</span></p>
                <p>Host: <span id="email-host">--</span></p>
            </div>
        </div>
    </div>

    <!-- PERFORMANCE METRICS -->
    <div class="monitoring-section">
        <h2 class="section-header" data-toggle="performance-metrics">
            <i class="bi bi-speedometer2"></i> Performance Metrics
            <i class="bi bi-chevron-down collapse-icon"></i>
        </h2>
        <div class="dashboard-grid collapsible-content collapsed" id="performance-metrics">
            <div class="dashboard-card">
                <h3><i class="bi bi-cpu"></i> CPU & Memory</h3>
                <p>CPU Usage: <strong id="cpu-usage">--</strong>%</p>
                <p>Memory Used: <strong id="memory-used">--</strong>MB / <strong id="memory-max">--</strong>MB</p>
                <p>Usage: <strong id="memory-usage-percent">--</strong>%</p>
            </div>

            <div class="dashboard-card">
                <h3><i class="bi bi-graph-up"></i> Response Times</h3>
                <p>Avg Response: <strong id="avg-response-time">--</strong>ms</p>
                <p>Requests/sec: <strong id="requests-per-second">--</strong></p>
                <p>Error Rate: <strong id="error-rate">--</strong>%</p>
            </div>

            <div class="dashboard-card">
                <h3><i class="bi bi-hdd"></i> Disk & Storage</h3>
                <p>Disk Usage: <strong id="disk-usage-percent">--</strong>%</p>
                <p>Free Space: <strong id="disk-free-space">--</strong>GB</p>
            </div>

            <div class="dashboard-card">
                <h3><i class="bi bi-diagram-3"></i> JVM Threads</h3>
                <p>Live Threads: <strong id="threads-live">--</strong></p>
                <p>Peak Threads: <strong id="threads-peak">--</strong></p>
            </div>
        </div>
    </div>

    <!-- HTTP STATUS MONITORING -->
    <div class="monitoring-section">
        <h2 class="section-header" data-toggle="http-monitoring">
            <i class="bi bi-bar-chart"></i> HTTP Status Monitoring
            <i class="bi bi-chevron-down collapse-icon"></i>
        </h2>
        <div class="dashboard-grid collapsible-content collapsed" id="http-monitoring">
            <div class="dashboard-card">
                <h3><i class="bi bi-check-circle text-success"></i> Success Responses</h3>
                <p>HTTP 200: <strong id="http-200">--</strong></p>
            </div>

            <div class="dashboard-card">
                <h3><i class="bi bi-exclamation-triangle text-warning"></i> Client Errors</h3>
                <p>HTTP 404: <strong id="http-404">--</strong></p>
            </div>

            <div class="dashboard-card">
                <h3><i class="bi bi-x-circle text-danger"></i> Server Errors</h3>
                <p>HTTP 500: <strong id="http-500">--</strong></p>
            </div>

            <div class="dashboard-card">
                <h3><i class="bi bi-exclamation-circle"></i> Total Errors</h3>
                <p>Total: <strong id="total-errors">--</strong></p>
            </div>
        </div>
    </div>


    <!-- REPORTS MANAGEMENT  -->
    <div class="monitoring-section">
        <h2 class="section-header" data-toggle="reports-management">
            <span><i class="bi bi-flag"></i> Reports Management</span>
            <i class="bi bi-chevron-down collapse-icon"></i>
        </h2>
        <div class="collapsible-content" id="reports-management">

            <!-- Professional Header -->
            <div class="reports-management-header">
                <div class="reports-stats">
                    <div class="stat-item">
                        <i class="bi bi-hourglass-split" style="color: #d97706;"></i>
                        <span>Pending: <strong id="reports-pending-count">--</strong></span>
                    </div>
                    <div class="stat-item">
                        <i class="bi bi-bar-chart" style="color: #3b82f6;"></i>
                        <span>Total: <strong id="reports-total-count">--</strong></span>
                    </div>
                </div>
                <div class="reports-actions">
                    <button id="reports-refresh-btn" class="btn btn-sm btn-outline-success">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                    <button id="mark-reviewed-btn" class="btn btn-sm btn-success" disabled>
                        <i class="bi bi-check"></i> Mark Reviewed
                    </button>
                    <button id="delete-reports-btn" class="btn btn-sm btn-danger" disabled>
                        <i class="bi bi-trash"></i> Delete
                    </button>
                </div>
            </div>

            <!-- Professional Reports Table -->
            <div class="reports-table-container">
                <table id="reports-table" class="table">
                    <thead>
                    <tr>
                        <th style="width: 40px;">
                            <input type="checkbox" id="select-all-reports">
                        </th>
                        <th class="sortable" data-column="entityType" style="width: 120px;">
                            Тип
                        </th>
                        <th class="sortable" data-column="reportCount" style="width: 100px;">
                            Брой репорти
                        </th>
                        <th class="sortable" data-column="numberOfReporters" style="width: 150px;">
                            Докладвачи
                        </th>
                        <th style="width: 200px;">
                            Описание
                        </th>
                        <th class="sortable" data-column="mostCommonReason" style="width: 150px;">
                            Най-честа причина
                        </th>
                        <th class="sortable" data-column="status" style="width: 100px;">
                            Статус
                        </th>
                        <th class="sortable" data-column="lastReportDate" style="width: 140px;">
                            Дата
                        </th>
                        <th style="width: 100px;">
                            Действия
                        </th>
                    </tr>
                    </thead>
                    <tbody id="reports-table-body">
                    <!-- JavaScript ще попълни тук -->
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <!-- ====== ACTIVITY WALL SECTION ====== -->
    <div class="monitoring-section">
        <h2 class="section-header collapsible-header" data-toggle="activity-wall">
            <span><i class="bi bi-activity"></i> Real-time Activity Wall</span>
            <i class="bi bi-chevron-down collapse-icon"></i>
        </h2>

        <div class="collapsible-content" id="activity-wall">

            <!-- Activity Header -->
            <div class="activity-wall-header">
                <div class="activity-stats">
                    <div class="stat-item">
                        <i class="bi bi-broadcast" style="color: #28a745;"></i>
                        <span>Online: <strong id="online-users-count">--</strong></span>
                    </div>
                    <div class="stat-item">
                        <i class="bi bi-clock-history" style="color: #007bff;"></i>
                        <span>Последен час: <strong id="last-hour-activities">--</strong></span>
                    </div>
                    <div class="stat-item">
                        <i class="bi bi-graph-up" style="color: #6f42c1;"></i>
                        <span>Днес: <strong id="today-activities">--</strong></span>
                    </div>
                </div>

                <div class="activity-controls">
                    <div class="live-indicator" id="liveIndicator">
                        <div class="live-dot"></div>
                        <span>Live</span>
                    </div>

                    <button id="activity-pause-btn" class="btn btn-sm btn-warning">
                        <i class="bi bi-pause-fill"></i> Пауза
                    </button>

                    <button id="activity-clear-btn" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-trash"></i> Изчисти
                    </button>

                    <button id="activity-export-btn" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-download"></i> Експорт
                    </button>
                </div>
            </div>

            <!-- Activity Filters -->
            <div class="activity-filters">
                <div class="filter-group">
                    <span class="filter-label">Действия:</span>
                    <button class="activity-filter-btn create active" data-filter="create">
                        <i class="bi bi-plus-circle"></i>
                        <span>Създаване</span>
                    </button>
                    <button class="activity-filter-btn interact active" data-filter="interact">
                        <i class="bi bi-hand-thumbs-up"></i>
                        <span>Взаимодействия</span>
                    </button>
                    <button class="activity-filter-btn moderate active" data-filter="moderate">
                        <i class="bi bi-shield-exclamation"></i>
                        <span>Модерация</span>
                    </button>
                    <button class="activity-filter-btn auth active" data-filter="auth">
                        <i class="bi bi-person-check"></i>
                        <span>Автентикация</span>
                    </button>
                    <button class="activity-filter-btn other active" data-filter="other">
                        <i class="bi bi-three-dots"></i>
                        <span>Други</span>
                    </button>
                </div>

                <div class="filter-group">
                    <span class="filter-label">Потребители:</span>
                    <input type="text" id="activity-user-filter" class="form-control form-control-sm"
                           placeholder="Филтрирай по потребител..." style="width: 200px;">
                </div>
            </div>

            <!-- Activity Stream Table -->
            <div class="activity-stream-container">
                <table id="activity-stream-table" class="table table-sm">
                    <thead>
                    <tr>
                        <th style="width: 120px;">Време</th>
                        <th style="width: 60px;">Тип</th>
                        <th style="width: 150px;">Потребител</th>
                        <th style="width: 200px;">Действие</th>
                        <th>Детайли</th>
                        <th style="width: 80px;">IP</th>
                    </tr>
                    </thead>
                    <tbody id="activity-stream-body">
                    <!-- Activities will be loaded here via JavaScript -->
                    <tr>
                        <td colspan="6" class="text-center" style="padding: 2rem; color: #6b7280;">
                            <i class="bi bi-broadcast" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                            <div>Зареждане на активности...</div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Activity Stream Stats Footer -->
            <div class="activity-stream-footer">
                <div class="stream-info">
                    <span>Показани: <strong id="visible-activities">0</strong> от <strong id="total-activities">0</strong></span>
                    <span class="separator">•</span>
                    <span>Последно обновяване: <strong id="last-update">--</strong></span>
                </div>

                <div class="stream-controls">
                    <button id="scroll-to-top-btn" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-arrow-up"></i> Отгоре
                    </button>
                    <button id="auto-scroll-btn" class="btn btn-sm btn-outline-primary active">
                        <i class="bi bi-arrow-down"></i> Авто скрол
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Detail Modal -->
    <div class="modal fade" id="activityDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-info-circle"></i> Детайли за активността
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="activity-detail-content">
                        <!-- Activity details will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Затвори</button>
                    <button type="button" class="btn btn-primary" id="view-related-btn">
                        <i class="bi bi-eye"></i> Виж свързаното съдържание
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<div th:replace="~{fragments/footer :: footer}"></div>

<script src="/js/admin/admin-dashboard.js"></script>
<script src="/js/admin/reports.js"></script>
<script src="/js/admin/activity-wall.js"></script>

<!-- Bottom Styles -->
<div th:replace="~{fragments/bottomHtmlStyles :: bottomStyles}"></div>

</body>
</html>