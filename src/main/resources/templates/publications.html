<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ====== DYNAMIC TITLE AND DESCRIPTION ====== -->
  <title th:if="${hasOpenGraph}" th:text="${ogTitle + ' - SmolyanVote'}">–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ - SmolyanVote</title>
  <title th:unless="${hasOpenGraph}">–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ - SmolyanVote</title>

  <meta th:if="${hasOpenGraph}" name="description" th:content="${ogDescription}">
  <meta th:unless="${hasOpenGraph}" name="description" content="–ü—Ä–∏—Å—ä–µ–¥–∏–Ω–µ—Ç–µ —Å–µ –∫—ä–º –æ–±—Å—ä–∂–¥–∞–Ω–µ—Ç–æ –≤ SmolyanVote - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ —É—á–∞—Å—Ç–∏–µ –≤ –°–º–æ–ª—è–Ω.">

  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

  <!-- ====== OPEN GRAPH META TAGS (—Å–∞–º–æ –∫–æ–≥–∞—Ç–æ hasOpenGraph –µ true) ====== -->

  <meta th:if="${hasOpenGraph}" property="og:type" content="article" />
  <meta th:if="${hasOpenGraph}" property="og:site_name" content="SmolyanVote" />
  <meta th:if="${hasOpenGraph}" property="og:title" th:content="${ogTitle}" />
  <meta th:if="${hasOpenGraph}" property="og:description" th:content="${ogDescription}" />
  <meta th:if="${hasOpenGraph}" property="og:url" th:content="${ogUrl}" />
  <meta th:if="${hasOpenGraph}" property="og:image" th:content="${ogImage}" />
  <meta th:if="${hasOpenGraph}" property="og:image:width" content="1200" />
  <meta th:if="${hasOpenGraph}" property="og:image:height" content="630" />
  <meta th:if="${hasOpenGraph}" property="og:image:alt" th:content="${ogTitle}" />
  <meta th:if="${hasOpenGraph}" property="og:locale" content="bg_BG" />
  <meta th:if="${ogAuthor}" property="article:author" th:content="${ogAuthor}" />
  <meta th:if="${ogPublishedTime}" property="article:published_time" th:content="${ogPublishedTime}" />
  <meta th:if="${ogSection}" property="article:section" th:content="${ogSection}" />
  <meta property="article:tag" content="SmolyanVote" />
  <meta property="article:tag" content="–°–º–æ–ª—è–Ω" />
  <meta property="article:tag" content="–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ —É—á–∞—Å—Ç–∏–µ" />

  <!-- Twitter Cards -->
  <meta th:if="${hasOpenGraph}" name="twitter:card" content="summary_large_image" />
  <meta th:if="${hasOpenGraph}" name="twitter:title" th:content="${ogTitle}" />
  <meta th:if="${hasOpenGraph}" name="twitter:description" th:content="${ogDescription}" />
  <meta th:if="${hasOpenGraph}" name="twitter:image" th:content="${ogImage}" />
  <meta name="twitter:site" content="@SmolyanVote" />
  <meta th:if="${ogAuthor}" name="twitter:creator" th:content="'@' + ${ogAuthor}" />

  <!-- CANONICAL URL -->
  <link th:if="${hasOpenGraph}" rel="canonical" th:href="${ogUrl}">
  <link th:unless="${hasOpenGraph}" rel="canonical" href="https://smolyanvote.com/publications">
  
  <!-- HREFLANG TAGS -->
  <link th:if="${hasOpenGraph}" rel="alternate" hreflang="bg" th:href="${ogUrl}">
  <link th:unless="${hasOpenGraph}" rel="alternate" hreflang="bg" href="https://smolyanvote.com/publications">
  <link th:if="${hasOpenGraph}" rel="alternate" hreflang="x-default" th:href="${ogUrl}">
  <link th:unless="${hasOpenGraph}" rel="alternate" hreflang="x-default" href="https://smolyanvote.com/publications">

  <!-- Existing Thymeleaf fragments -->
  <th:block th:replace="~{fragments/topHtmlStyles :: navbarStyles}"></th:block>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/createPublication.css">
  <link rel="stylesheet" href="/css/publications/publicationsDetailModal.css">
  <link rel="stylesheet" href="/css/comments.css">
  <link rel="stylesheet" href="/css/publications/publications.css">
  <link rel="stylesheet" href="/css/publications/userSearch.css">
  <link rel="stylesheet" href="/css/particles-background.css">

  <!-- Thymeleaf data for JavaScript -->
  <script th:inline="javascript">
    window.isAuthenticated = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;
    window.currentUserId = /*[[${currentUserId}]]*/ null;
    window.currentUsername = /*[[${#authentication.name ?: ''}]]*/ '';
    window.currentUserImage = /*[[${currentUserImage ?: '/images/default-avatar.png'}]]*/ '/images/default-avatar.png';
    window.isAdmin = /*[[${#authorization.expression('hasRole(''ADMIN'')')}]]*/ false;

    window.appData = {
      isAuthenticated: window.isAuthenticated,
      currentUserId: window.currentUserId,
      currentUsername: window.currentUsername,
      currentUserImage: window.currentUserImage,
      isAdmin: window.isAdmin,
      csrfToken: /*[[${_csrf.token}]]*/ '',
      csrfHeader: /*[[${_csrf.headerName}]]*/ '',
      totalPublications: /*[[${totalPublications ?: 0}]]*/ 0,
      categoryCounts: {
        news: /*[[${newsCount ?: 0}]]*/ 0,
        infrastructure: /*[[${infrastructureCount ?: 0}]]*/ 0,
        municipal: /*[[${municipalCount ?: 0}]]*/ 0,
        initiatives: /*[[${initiativesCount ?: 0}]]*/ 0,
        culture: /*[[${cultureCount ?: 0}]]*/ 0,
        other: /*[[${otherCount ?: 0}]]*/ 0
      }
    };
  </script>
</head>
<body class="publications-page">
<!-- Landscape Warning - Mobile Portrait Only -->


<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Mobile Filter Toggle -->
<div class="mobile-filter-toggle" id="mobileFilterToggle">
  <button class="filter-toggle-btn">
    <i class="bi bi-funnel-fill"></i>
    <span>–§–∏–ª—Ç—Ä–∏</span>
  </button>
</div>

<!-- Main Feed Container -->
<div class="feed-layout">
  <!-- Left Sidebar - Filters -->
  <aside class="left-sidebar" id="leftSidebar">
    <div class="sidebar-header">
      <h3 class="filters-title">
        <i class="bi bi-funnel-fill"></i>
        –§–∏–ª—Ç—Ä–∏
      </h3>
      <button class="close-sidebar" id="closeSidebar">
        <i class="bi bi-x"></i>
      </button>
    </div>

    <!-- User Search Panel -->
    <div class="user-search-panel">
      <div class="user-search-header">
        <h4 class="user-search-title">
          <i class="bi bi-people-fill"></i>
          –¢—ä—Ä—Å–∏ –∞–≤—Ç–æ—Ä–∏
        </h4>
        <button class="expand-collapse-btn" id="expandUserSearch" title="–†–∞–∑—à–∏—Ä–∏/—Å–≤–∏–π">
          <i class="bi bi-chevron-down"></i>
        </button>
      </div>
      
      <div class="user-search-content" id="userSearchContent">
        <div class="user-search-input-container">
          <input type="text" class="user-search-input" id="userSearchInput" placeholder="–¢—ä—Ä—Å–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª...">
          <div class="search-icon">
            <i class="bi bi-search"></i>
          </div>
          <div class="search-loading" id="searchLoading" style="display: none;">
            <i class="bi bi-hourglass-split"></i>
          </div>
        </div>
        
        <div class="user-search-dropdown" id="userSearchDropdown"></div>
        
        <div class="selected-users-list" id="selectedUsersList"></div>
      </div>
    </div>

    <div class="filters-panel">
      <!-- Search -->
      <div class="filter-section">
        <label class="filter-label">–¢—ä—Ä—Å–µ–Ω–µ</label>
        <div class="search-input-wrapper">
          <i class="bi bi-search search-icon"></i>
          <input type="text" id="searchInput" placeholder="–¢—ä—Ä—Å–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏..." class="search-input">
          <button class="clear-search" id="clearSearch" style="display: none;">
            <i class="bi bi-x"></i>
          </button>
        </div>
      </div>

      <!-- Category Filter -->
      <div class="filter-section">
        <label class="filter-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <div class="filter-options">
          <div class="filter-option active" data-filter="category" data-value="">
            <i class="bi bi-grid-3x3-gap"></i>
            <span>–í—Å–∏—á–∫–∏</span>
            <span class="count" th:text="${totalPublications}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="news">
            <i class="bi bi-newspaper"></i>
            <span>–ù–æ–≤–∏–Ω–∏</span>
            <span class="count" th:text="${newsCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="infrastructure">
            <i class="bi bi-tools"></i>
            <span>–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</span>
            <span class="count" th:text="${infrastructureCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="municipal">
            <i class="bi bi-building"></i>
            <span>–û–±—â–∏–Ω–∞</span>
            <span class="count" th:text="${municipalCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="initiatives">
            <i class="bi bi-lightbulb"></i>
            <span>–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∏</span>
            <span class="count" th:text="${initiativesCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="culture">
            <i class="bi bi-palette"></i>
            <span>–ö—É–ª—Ç—É—Ä–∞</span>
            <span class="count" th:text="${cultureCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="other">
            <i class="bi bi-three-dots"></i>
            <span>–î—Ä—É–≥–∏</span>
            <span class="count" th:text="${otherCount}">0</span>
          </div>
        </div>
      </div>

      <!-- Time Filter -->
      <div class="filter-section">
        <label class="filter-label">–ü–µ—Ä–∏–æ–¥</label>
        <div class="filter-options">
          <div class="filter-option active" data-filter="time" data-value="">
            <i class="bi bi-clock"></i>
            <span>–í—Å–∏—á–∫–∏</span>
          </div>
          <div class="filter-option" data-filter="time" data-value="today">
            <i class="bi bi-sun"></i>
            <span>–î–Ω–µ—Å</span>
          </div>
          <div class="filter-option" data-filter="time" data-value="week">
            <i class="bi bi-calendar-week"></i>
            <span>–¢–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞</span>
          </div>
          <div class="filter-option" data-filter="time" data-value="month">
            <i class="bi bi-calendar-month"></i>
            <span>–¢–æ–∑–∏ –º–µ—Å–µ—Ü</span>
          </div>
        </div>
      </div>

      <!-- Sort Filter -->
      <div class="filter-section">
        <label class="filter-label">–ü–æ–¥—Ä–µ–¥–±–∞</label>
        <div class="filter-options">
          <div class="filter-option active" data-filter="sort" data-value="date-desc">
            <i class="bi bi-sort-down"></i>
            <span>–ù–∞–π-–Ω–æ–≤–∏</span>
          </div>
          <div class="filter-option" data-filter="sort" data-value="date-asc">
            <i class="bi bi-sort-up"></i>
            <span>–ù–∞–π-—Å—Ç–∞—Ä–∏</span>
          </div>
          <div class="filter-option" data-filter="sort" data-value="likes">
            <i class="bi bi-heart"></i>
            <span>–ù–∞–π-—Ö–∞—Ä–µ—Å–≤–∞–Ω–∏</span>
          </div>
          <div class="filter-option" data-filter="sort" data-value="comments">
            <i class="bi bi-chat"></i>
            <span>–ù–∞–π-–∫–æ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∏</span>
          </div>
        </div>
      </div>

      <!-- Clear All Filters -->
      <button class="clear-all-filters" id="clearAllFilters">
        <i class="bi bi-arrow-clockwise"></i>
        –ò–∑—á–∏—Å—Ç–∏ –≤—Å–∏—á–∫–∏ —Ñ–∏–ª—Ç—Ä–∏
      </button>

      <!-- Active Filters Summary -->
      <div class="active-filters-summary" id="activeFiltersSummary" style="display: none;">
        <h4>–ê–∫—Ç–∏–≤–Ω–∏ —Ñ–∏–ª—Ç—Ä–∏</h4>
        <div class="active-filters-list" id="activeFiltersList">
          <!-- Active filters will be shown here -->
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Feed -->
  <main class="main-feed particles-background-wrapper" id="mainFeed">
    <div class="particles-background" data-particles-theme="green" data-particles-count="60"></div>
    <!-- Create Post -->
    <div class="create-post" th:if="${#authorization.expression('isAuthenticated()')}">
      <!-- Quick Actions Row -->
      <div class="create-post-header">
        <div class="user-avatar"
             th:attr="data-user-image=${currentUserImage ?: '/images/default-avatar.png'},data-username=${currentUser.username ?: '–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª'}">
        </div>
        <div class="create-post-input" onclick="expandCreateForm()">
          <span th:text="'–ö–∞–∫–≤–æ –º–∏—Å–ª–∏—à, ' + ${currentUser.username ?: '–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª'}">–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</span>?</span>
        </div>
      </div>

      <!-- Expanded Form -->
      <div class="create-post-expanded" id="createPostExpanded" style="display: none;">
        <!-- Image Preview -->
        <div class="image-preview-section" id="imagePreviewSection" style="display: none;">
          <div class="image-preview-container" id="imagePreviewContainer"></div>
        </div>

        <!-- Text Area -->
        <textarea class="post-textarea" id="postContent"
                  placeholder="–ù–∞–ø–∏—à–∏ —Ç–≤–æ—è –ø–æ—Å—Ç..."
                  rows="3" minlength="1" required></textarea>

        <!-- Selected Emotion -->
        <div class="selected-emotion" id="selectedEmotion" style="display: none;"></div>

        <!-- Category -->
        <div class="category-row">
          <select class="category-select" id="postCategory">
            <option value="">–ò–∑–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è</option>
            <option value="news">üì∞ –ù–æ–≤–∏–Ω–∏</option>
            <option value="infrastructure">üîß –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</option>
            <option value="municipal">üèõÔ∏è –û–±—â–∏–Ω–∞</option>
            <option value="initiatives">üí° –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∏</option>
            <option value="culture">üé® –ö—É–ª—Ç—É—Ä–Ω–∏ —Å—ä–±–∏—Ç–∏—è</option>
            <option value="other">üìã –î—Ä—É–≥–∏</option>
          </select>
        </div>

        <!-- Link Input Section -->
        <div class="link-input-section" id="linkInputSection" style="display: none;">
          <div class="link-input-wrapper">
            <input type="url" class="link-input" id="postLink"
                   placeholder="–ü–æ—Å—Ç–∞–≤–∏ –ª–∏–Ω–∫ (YouTube, —Å–Ω–∏–º–∫–∞, —É–µ–±—Å–∞–π—Ç...)">
          </div>

          <!-- Link Preview Container -->
          <div class="link-preview-container" id="linkPreviewContainer" style="display: none;">
            <div class="link-preview" id="linkPreview">
              <!-- –î–∏–Ω–∞–º–∏—á–Ω–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ —â–µ —Å–µ –¥–æ–±–∞–≤—è —Ç—É–∫ -->
            </div>
          </div>
        </div>

        <!-- Options Row -->
        <div class="options-buttons">
          <button class="option-btn" id="imageBtn" title="–°–Ω–∏–º–∫–∞">
            <i class="bi bi-image"></i>
          </button>
          <button class="option-btn" id="linkBtn" title="–õ–∏–Ω–∫">
            <i class="bi bi-link-45deg"></i>
          </button>
          <button class="option-btn" id="emotionBtn" title="–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ">
            <i class="bi bi-emoji-smile"></i>
          </button>
        </div>

        <!-- Emotion Picker -->
        <div class="emotion-picker" id="emotionPicker" style="display: none;">
          <div class="emotions-list">
            <button class="emotion-item" data-emotion="üòä" data-text="—â–∞—Å—Ç–ª–∏–≤/–∞">
              <span class="emotion-icon">üòä</span>
              <span class="emotion-label">—â–∞—Å—Ç–ª–∏–≤/–∞</span>
            </button>
            <button class="emotion-item" data-emotion="üò¢" data-text="—Ç—ä–∂–µ–Ω/–∞">
              <span class="emotion-icon">üò¢</span>
              <span class="emotion-label">—Ç—ä–∂–µ–Ω/–∞</span>
            </button>
            <button class="emotion-item" data-emotion="üò†" data-text="—è–¥–æ—Å–∞–Ω/–∞">
              <span class="emotion-icon">üò†</span>
              <span class="emotion-label">—è–¥–æ—Å–∞–Ω/–∞</span>
            </button>
            <button class="emotion-item" data-emotion="üòç" data-text="–≤–ª—é–±–µ–Ω/–∞">
              <span class="emotion-icon">üòç</span>
              <span class="emotion-label">–≤–ª—é–±–µ–Ω/–∞</span>
            </button>
            <button class="emotion-item" data-emotion="ü§î" data-text="–∑–∞–º–∏—Å–ª–µ–Ω/–∞">
              <span class="emotion-icon">ü§î</span>
              <span class="emotion-label">–∑–∞–º–∏—Å–ª–µ–Ω/–∞</span>
            </button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn-cancel" id="cancelPost">–û—Ç–∫–∞–∑</button>
          <button class="btn-publish" id="submitPost" disabled>–ü—É–±–ª–∏–∫—É–≤–∞–π</button>
        </div>
      </div>

      <!-- Collapsed Actions -->
      <div class="create-post-actions" id="collapsedActions">
        <button class="action-item" onclick="expandCreateForm()">
          <i class="bi bi-pencil"></i>
          <span>–ü—É–±–ª–∏–∫–∞—Ü–∏—è</span>
        </button>
        <button class="action-item" onclick="expandCreateForm(); setTimeout(() => document.getElementById('imageBtn').click(), 100)">
          <i class="bi bi-image"></i>
          <span>–°–Ω–∏–º–∫–∞</span>
        </button>
        <button class="action-item" onclick="expandCreateForm(); setTimeout(() => document.getElementById('emotionBtn').click(), 100)">
          <i class="bi bi-emoji-smile"></i>
          <span>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span>
        </button>
      </div>

      <!-- Hidden File Input -->
      <input type="file" id="postImage" accept="image/*" style="display: none;">
    </div>

    <!-- Login Prompt for Guests -->
    <div class="login-prompt" th:if="${#authorization.expression('!isAuthenticated()')}">
      <div class="prompt-content">
        <i class="bi bi-person-circle"></i>
        <h3>–í–ª–µ–∑—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ —Å–∏</h3>
        <p>–ó–∞ –¥–∞ —Å—ä–∑–¥–∞–≤–∞—Ç–µ –∏ —Ö–∞—Ä–µ—Å–≤–∞—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –º–æ–ª—è –≤–ª–µ–∑—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ —Å–∏ –∏–ª–∏ —Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π—Ç–µ.</p>
        <div class="prompt-actions">
          <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" class="publications-btn btn-primary">–í—Ö–æ–¥</a>
          <a href="/register" class="publications-btn btn-outline-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        </div>
      </div>
    </div>

    <!-- Posts Feed -->
    <div class="posts-container" id="postsContainer">
      <!-- Posts will be loaded here via JavaScript -->
    </div>

    <!-- Loading Indicator -->
    <div class="loading-indicator" id="loadingIndicator">
      <div class="spinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
      </div>
      <span>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏...</span>
    </div>

    <!-- No More Posts Message -->
    <div class="no-more-posts" id="noMorePosts" style="display: none;">
      <i class="bi bi-check-circle-fill"></i>
      <span>–í—Å–∏—á–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏</span>
    </div>

    <!-- No Results Message -->
    <div class="no-results" id="noResults" style="display: none;">
      <i class="bi bi-search"></i>
      <h3>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h3>
      <p>–û–ø–∏—Ç–∞–π—Ç–µ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏—Ç–µ –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ –∏–ª–∏ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ.</p>
      <button class="publications-btn btn-primary" onclick="clearAllFilters()">
        <i class="bi bi-arrow-clockwise"></i>
        –ò–∑—á–∏—Å—Ç–∏ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ
      </button>
    </div>
  </main>

  <!-- Right Sidebar - Platform Overview -->
  <aside class="right-sidebar">
    
    <!-- Statistics Widget -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-bar-chart-fill"></i>
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        <button id="refreshSidebarBtn" title="–û–±–Ω–æ–≤–∏">
          <i class="bi bi-arrow-clockwise"></i>
        </button>
      </h3>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number stat-total">0</div>
          <div class="stat-label">–û–±—â–æ</div>
        </div>
        <div class="stat-item">
          <div class="stat-number stat-today">0</div>
          <div class="stat-label">–î–Ω–µ—Å</div>
        </div>
        <div class="stat-item">
          <div class="stat-number stat-week">0</div>
          <div class="stat-label">–°–µ–¥–º–∏—Ü–∞</div>
        </div>
        <div class="stat-item">
          <div class="stat-number stat-online">0</div>
          <div class="stat-label">–û–Ω–ª–∞–π–Ω</div>
        </div>
      </div>
    </div>

    <!-- Top Authors Today -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-trophy-fill"></i>
        –¢–æ–ø 5 –ê–≤—Ç–æ—Ä–∏ –Ω–∞ –¥–µ–Ω—è
      </h3>
      <div class="top-authors-today" id="topAuthorsToday">
        <div class="empty-widget">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
      </div>
    </div>

    <!-- Trending Topics -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-trending-up"></i>
        –ü–æ–ø—É–ª—è—Ä–Ω–∏ —Ç–µ–º–∏
      </h3>
      <div class="trending-topics" id="trendingTopics">
        <div class="empty-widget">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
      </div>
    </div>

    <!-- Last Activity -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-clock-history"></i>
        –ü–æ—Å–ª–µ–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç
      </h3>
      <div id="lastActivityWidget">
        <div class="empty-widget">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
      </div>
    </div>

    <!-- Most Commented Today -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-fire"></i>
        –ù–∞–π-–∫–æ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞ –¥–Ω–µ—Å
      </h3>
      <div id="mostCommentedWidget">
        <div class="empty-widget">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
      </div>
    </div>

    <!-- Top 3 Most Viewed Today -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-eye-fill"></i>
        –¢–æ–ø 3 –Ω–∞–π-–≥–ª–µ–¥–∞–Ω–∏ –¥–Ω–µ—Å
      </h3>
      <div id="topViewedWidget">
        <div class="empty-widget">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
      </div>
    </div>

    <!-- Last Published Post -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-newspaper"></i>
        –ü–æ—Å–ª–µ–¥–Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è
      </h3>
      <div id="lastPublishedWidget">
        <div class="empty-widget">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
      </div>
    </div>

  </aside>
</div>

<!-- Scroll to Top Button -->
<button class="scroll-to-top" id="scrollToTop" style="display: none;">
  <i class="bi bi-arrow-up"></i>
</button>

<!-- Mobile Overlay -->
<div class="mobile-overlay" id="mobileOverlay"></div>

<!-- Footer -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Post Detail Modal Fragment -->
<div th:replace="~{fragments/publications-detail-modal :: postModal}"></div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script src="/js/utils/particles-background.js"></script>
<div th:replace="~{fragments/bottomHtmlStyles :: bottomStyles}"></div>

<script src="/js/publications/filtersManager.js"></script>
<script src="/js/publications/publicationsApi.js"></script>
<script src="/js/publications/postInteractions.js"></script>
<script src="/js/publications/publicationsMain.js"></script>
<script src="/js/publications/publicationDetailModal.js"></script>
<script src="/js/commentsManager.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–º–µ avatar placeholders
    setTimeout(() => {
      initializeAvatarPlaceholders();
      // –°—ä—â–æ —Ç–∞–∫–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      if (window.avatarUtils) {
        window.avatarUtils.updateAll();
      }
    }, 300);

    if (window.PublicationsManager) {
      window.publicationsManager = new PublicationsManager();
    }

    if (window.PublicationDetailModal) {
      window.publicationModal = new PublicationDetailModal();
    }

    if (window.PostInteractions) {
      window.postInteractions = new PostInteractions();
    }
  });

  // –§—É–Ω–∫—Ü–∏—è –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ avatar placeholders
  function initializeAvatarPlaceholders() {
    document.querySelectorAll('.avatar-placeholder').forEach(placeholder => {
      const imageUrl = placeholder.getAttribute('data-user-image');
      const username = placeholder.getAttribute('data-username');
      const userId = placeholder.getAttribute('data-user-id');
      const size = placeholder.offsetWidth || 40;
      const className = placeholder.className.replace('avatar-placeholder', '').trim();

      if (window.createAvatar && username) {
        // –î–æ–±–∞–≤—è–º–µ user-id –∞—Ç—Ä–∏–±—É—Ç –∞–∫–æ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞
        const avatarHtml = window.createAvatar(imageUrl, username, size, className);
        placeholder.outerHTML = avatarHtml;
      }
    });
  }
</script>

<!-- ====== AUTO OPEN MODAL SCRIPT ====== -->
<script th:if="${autoOpenModal}">
  document.addEventListener('DOMContentLoaded', function() {
    // –ò–∑—á–∞–∫–∞–π –¥–∞ —Å–µ –∑–∞—Ä–µ–¥—è—Ç –≤—Å–∏—á–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
    setTimeout(function() {
      const publicationId = /*[[${modalPublicationId}]]*/ null;

      if (publicationId && window.openPostModal) {
        console.log('üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ –º–æ–¥–∞–ª –∑–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è:', publicationId);

        // –û—Ç–≤–æ—Ä–∏ –º–æ–¥–∞–ª–∞ —Å—ä—Å —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è
        window.openPostModal(publicationId);

        // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–ª–µ–¥ 3 —Å–µ–∫—É–Ω–¥–∏
        setTimeout(function() {
          showAutoRedirectNotification();
        }, 3000);
      }
    }, 1500);
  });

  function showAutoRedirectNotification() {
    // –°—ä–∑–¥–∞–π notification –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–Ω–∞—Å–æ—á–≤–∞–Ω–µ
    const notification = document.createElement('div');
    notification.innerHTML = `
        <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
                    background: #4cb15c; color: white; padding: 16px 24px;
                    border-radius: 12px; z-index: 10001; font-family: 'Inter', sans-serif;
                    box-shadow: 0 8px 32px rgba(0,0,0,0.2); max-width: 400px; text-align: center;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <i class="bi bi-info-circle" style="font-size: 20px;"></i>
                <div>
                    <div style="font-weight: 600; margin-bottom: 4px;">–°–ø–æ–¥–µ–ª–µ–Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è</div>
                    <div style="font-size: 14px; opacity: 0.9;">–©–µ –±—ä–¥–µ—Ç–µ –ø—Ä–µ–Ω–∞—Å–æ—á–µ–Ω–∏ –∫—ä–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏—Ç–µ —Å–ª–µ–¥ 30 —Å–µ–∫—É–Ω–¥–∏</div>
                </div>
            </div>
            <div style="margin-top: 12px; display: flex; gap: 8px; justify-content: center;">
                <button onclick="window.location.href='/publications'"
                        style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
                               color: white; padding: 6px 12px; border-radius: 6px; font-size: 13px; cursor: pointer;">
                    –û—Ç–∏–¥–∏ —Å–µ–≥–∞
                </button>
                <button onclick="this.closest('div').style.display='none'"
                        style="background: none; border: 1px solid rgba(255,255,255,0.3);
                               color: white; padding: 6px 12px; border-radius: 6px; font-size: 13px; cursor: pointer;">
                    –ó–∞—Ç–≤–æ—Ä–∏
                </button>
            </div>
        </div>
    `;

    document.body.appendChild(notification);

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–Ω–∞—Å–æ—á–≤–∞–Ω–µ —Å–ª–µ–¥ 30 —Å–µ–∫—É–Ω–¥–∏
    setTimeout(function() {
      window.location.href = '/publications';
    }, 30000);
  }
</script>
<script th:if="${autoOpenModal}" th:inline="javascript">
  document.addEventListener('DOMContentLoaded', () => {
    const postId = /*[[${modalPublicationId}]]*/ null;
    if (postId && window.openPostModal) {
      setTimeout(() => {
        window.openPostModal(postId);
      }, 500);
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const openModalId = urlParams.get('openModal');

    if (openModalId && window.openPostModal) {
      setTimeout(() => {
        console.log('üîÑ –û—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ –º–æ–¥–∞–ª –æ—Ç URL –ø–∞—Ä–∞–º–µ—Ç—ä—Ä:', openModalId);
        window.openPostModal(openModalId);
      }, 1000);
    }
  });
</script>

<!-- User Search Scripts -->
<script src="/js/publications/userSearch.js"></script>

<!-- Right Sidebar -->
<link rel="stylesheet" href="/css/publications/rightSideBar.css">
<script src="/js/publications/rightSideBar.js"></script>
<script src="/js/publications/reactionUsersModal.js"></script>

  <!-- ====== REACTION USERS MODAL ====== -->
  <div id="reactionUsersModal" class="reaction-users-modal" style="display: none;">
    <div class="reaction-users-modal-overlay" onclick="closeReactionUsersModal()"></div>
    <div class="reaction-users-modal-content">
      <div class="reaction-users-modal-header">
        <h3 id="reactionUsersModalTitle">–•–∞—Ä–µ—Å–∞–ª–∏</h3>
        <button class="reaction-users-modal-close" onclick="closeReactionUsersModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="reaction-users-modal-body" id="reactionUsersModalBody">
        <!-- Users will be loaded here -->
      </div>
    </div>
  </div>
</body>
</html>