<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ - SmolyanVote</title>
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/publications.css">
  <link rel="stylesheet" href="/css/createPublication.css">
  <link rel="stylesheet" href="/css/publicationsDetailModal.css">
  <link rel="stylesheet" href="/css/commentsPublications.css">
  <div th:replace="~{fragments/topHtmlStyles :: navbarStyles}"></div>

  <!-- Thymeleaf data for JavaScript -->
  <script th:inline="javascript">
    window.isAuthenticated = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;
    window.currentUserId = /*[[${currentUserId}]]*/ null;
    window.currentUsername = /*[[${#authentication.name ?: ''}]]*/ '';
    window.currentUserImage = /*[[${currentUserImage ?: '/images/default-avatar.png'}]]*/ '/images/default-avatar.png';

    window.appData = {
      isAuthenticated: window.isAuthenticated,
      currentUserId: window.currentUserId,
      currentUsername: window.currentUsername,
      currentUserImage: window.currentUserImage,
      csrfToken: /*[[${_csrf.token}]]*/ '',
      csrfHeader: /*[[${_csrf.headerName}]]*/ '',
      totalPublications: /*[[${totalPublications ?: 0}]]*/ 0,
      categoryCounts: {
        news: /*[[${newsCount ?: 0}]]*/ 0,
        infrastructure: /*[[${infrastructureCount ?: 0}]]*/ 0,
        municipal: /*[[${municipalCount ?: 0}]]*/ 0,
        initiatives: /*[[${initiativesCount ?: 0}]]*/ 0,
        culture: /*[[${cultureCount ?: 0}]]*/ 0,
        other: /*[[${otherCount ?: 0}]]*/ 0
      }
    };
  </script>
</head>
<body class="publications-page">
<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Mobile Filter Toggle -->
<div class="mobile-filter-toggle" id="mobileFilterToggle">
  <button class="filter-toggle-btn">
    <i class="bi bi-funnel-fill"></i>
    <span>–§–∏–ª—Ç—Ä–∏</span>
  </button>
</div>

<!-- Main Feed Container -->
<div class="feed-layout">
  <!-- Left Sidebar - Filters -->
  <aside class="left-sidebar" id="leftSidebar">
    <div class="sidebar-header">
      <h3 class="filters-title">
        <i class="bi bi-funnel-fill"></i>
        –§–∏–ª—Ç—Ä–∏
      </h3>
      <button class="close-sidebar" id="closeSidebar">
        <i class="bi bi-x"></i>
      </button>
    </div>

    <div class="filters-panel">
      <!-- Search -->
      <div class="filter-section">
        <label class="filter-label">–¢—ä—Ä—Å–µ–Ω–µ</label>
        <div class="search-input-wrapper">
          <i class="bi bi-search search-icon"></i>
          <input type="text" id="searchInput" placeholder="–¢—ä—Ä—Å–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏..." class="search-input">
          <button class="clear-search" id="clearSearch" style="display: none;">
            <i class="bi bi-x"></i>
          </button>
        </div>
      </div>

      <!-- Category Filter -->
      <div class="filter-section">
        <label class="filter-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <div class="filter-options">
          <div class="filter-option active" data-filter="category" data-value="">
            <i class="bi bi-grid-3x3-gap"></i>
            <span>–í—Å–∏—á–∫–∏</span>
            <span class="count" th:text="${totalPublications}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="news">
            <i class="bi bi-newspaper"></i>
            <span>–ù–æ–≤–∏–Ω–∏</span>
            <span class="count" th:text="${newsCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="infrastructure">
            <i class="bi bi-tools"></i>
            <span>–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</span>
            <span class="count" th:text="${infrastructureCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="municipal">
            <i class="bi bi-building"></i>
            <span>–û–±—â–∏–Ω–∞</span>
            <span class="count" th:text="${municipalCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="initiatives">
            <i class="bi bi-lightbulb"></i>
            <span>–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∏</span>
            <span class="count" th:text="${initiativesCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="culture">
            <i class="bi bi-palette"></i>
            <span>–ö—É–ª—Ç—É—Ä–Ω–∏ —Å—ä–±–∏—Ç–∏—è</span>
            <span class="count" th:text="${cultureCount}">0</span>
          </div>
          <div class="filter-option" data-filter="category" data-value="other">
            <i class="bi bi-three-dots"></i>
            <span>–î—Ä—É–≥–∏</span>
            <span class="count" th:text="${otherCount}">0</span>
          </div>
        </div>
      </div>

      <!-- Status Filter -->
      <div class="filter-section">
        <label class="filter-label">–°—Ç–∞—Ç—É—Å</label>
        <div class="filter-options">
          <div class="filter-option active" data-filter="status" data-value="">
            <i class="bi bi-eye"></i>
            <span>–í—Å–∏—á–∫–∏</span>
          </div>
          <div class="filter-option" data-filter="status" data-value="published">
            <i class="bi bi-globe"></i>
            <span>–ü—É–±–ª–∏–∫—É–≤–∞–Ω–∏</span>
          </div>
          <div class="filter-option" data-filter="status" data-value="review" th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
            <i class="bi bi-clock"></i>
            <span>–ó–∞ –ø—Ä–µ–≥–ª–µ–¥</span>
          </div>
          <div class="filter-option" data-filter="status" data-value="draft" th:if="${#authorization.expression('isAuthenticated()')}">
            <i class="bi bi-file-earmark"></i>
            <span>–ú–æ–∏—Ç–µ —á–µ—Ä–Ω–æ–≤–∏</span>
          </div>
        </div>
      </div>

      <!-- Sort Options -->
      <div class="filter-section">
        <label class="filter-label">–°–æ—Ä—Ç–∏—Ä–∞–Ω–µ</label>
        <div class="filter-options">
          <div class="filter-option active" data-filter="sort" data-value="date-desc">
            <i class="bi bi-sort-down"></i>
            <span>–ù–∞–π-–Ω–æ–≤–∏</span>
          </div>
          <div class="filter-option" data-filter="sort" data-value="date-asc">
            <i class="bi bi-sort-up"></i>
            <span>–ù–∞–π-—Å—Ç–∞—Ä–∏</span>
          </div>
          <div class="filter-option" data-filter="sort" data-value="likes">
            <i class="bi bi-heart-fill"></i>
            <span>–ù–∞–π-—Ö–∞—Ä–µ—Å–≤–∞–Ω–∏</span>
          </div>
          <div class="filter-option" data-filter="sort" data-value="views">
            <i class="bi bi-eye-fill"></i>
            <span>–ù–∞–π-–≥–ª–µ–¥–∞–Ω–∏</span>
          </div>
          <div class="filter-option" data-filter="sort" data-value="comments">
            <i class="bi bi-chat-fill"></i>
            <span>–ù–∞–π-–∫–æ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∏</span>
          </div>
        </div>
      </div>

      <!-- Time Filter -->
      <div class="filter-section">
        <label class="filter-label">–ü–µ—Ä–∏–æ–¥</label>
        <div class="filter-options">
          <div class="filter-option active" data-filter="time" data-value="">
            <i class="bi bi-infinity"></i>
            <span>–í—Å–∏—á–∫–∏</span>
          </div>
          <div class="filter-option" data-filter="time" data-value="today">
            <i class="bi bi-sun"></i>
            <span>–î–Ω–µ—Å</span>
          </div>
          <div class="filter-option" data-filter="time" data-value="week">
            <i class="bi bi-calendar-week"></i>
            <span>–¢–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞</span>
          </div>
          <div class="filter-option" data-filter="time" data-value="month">
            <i class="bi bi-calendar-month"></i>
            <span>–¢–æ–∑–∏ –º–µ—Å–µ—Ü</span>
          </div>
          <div class="filter-option" data-filter="time" data-value="year">
            <i class="bi bi-calendar-range"></i>
            <span>–¢–∞–∑–∏ –≥–æ–¥–∏–Ω–∞</span>
          </div>
        </div>
      </div>

      <!-- Author Filter -->
      <div class="filter-section" th:if="${#authorization.expression('isAuthenticated()')}">
        <label class="filter-label">–ê–≤—Ç–æ—Ä</label>
        <div class="filter-options">
          <div class="filter-option active" data-filter="author" data-value="">
            <i class="bi bi-people"></i>
            <span>–í—Å–∏—á–∫–∏ –∞–≤—Ç–æ—Ä–∏</span>
          </div>
          <div class="filter-option" data-filter="author" data-value="me">
            <i class="bi bi-person-circle"></i>
            <span>–ú–æ–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</span>
          </div>
          <div class="filter-option" data-filter="author" data-value="following">
            <i class="bi bi-person-plus"></i>
            <span>–°–ª–µ–¥–≤–∞–Ω–∏ –∞–≤—Ç–æ—Ä–∏</span>
          </div>
        </div>
      </div>

      <!-- Clear Filters -->
      <div class="filter-section">
        <button class="clear-all-filters" id="clearAllFilters">
          <i class="bi bi-arrow-clockwise"></i>
          –ò–∑—á–∏—Å—Ç–∏ –≤—Å–∏—á–∫–∏ —Ñ–∏–ª—Ç—Ä–∏
        </button>
      </div>
    </div>

    <!-- Active Filters Summary -->
    <div class="active-filters-summary" id="activeFiltersSummary" style="display: none;">
      <h4>–ê–∫—Ç–∏–≤–Ω–∏ —Ñ–∏–ª—Ç—Ä–∏:</h4>
      <div class="active-filters-list" id="activeFiltersList"></div>
    </div>
  </aside>

  <!-- Main Feed -->
  <main class="main-feed">
    <!-- Create Post Section -->
    <div class="create-post" th:if="${#authorization.expression('isAuthenticated()')}">
      <div class="create-post-header">
        <!-- –ü–†–û–ú–Ø–ù–ê 1: –ó–∞–º–µ–Ω—è–º–µ img —Å div –∫–æ–π—Ç–æ —â–µ —Å–µ –ø–æ–ø—ä–ª–Ω–∏ –æ—Ç avatarUtils -->
        <div class="user-avatar avatar-placeholder"
             th:attr="data-user-image=${currentUser.getImageUrl()},data-username=${currentUser.username}">
        </div>
        <div class="create-post-input" onclick="expandCreateForm()">
          <span class="placeholder-text">–ö–∞–∫–≤–æ –º–∏—Å–ª–∏—Ç–µ, <span th:text="${currentUser?.username ?: '–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª'}">–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</span>?</span>
        </div>
      </div>

      <!-- Expanded Form -->
      <div class="create-post-expanded" id="createPostExpanded" style="display: none;">
        <!-- Image Preview -->
        <div class="image-preview-section" id="imagePreviewSection" style="display: none;">
          <div class="image-preview-container" id="imagePreviewContainer"></div>
        </div>

        <!-- Text Area -->
        <textarea class="post-textarea" id="postContent"
                  placeholder="–ù–∞–ø–∏—à–∏ —Ç–≤–æ—è –ø–æ—Å—Ç..."
                  rows="3"></textarea>

        <!-- Selected Emotion -->
        <div class="selected-emotion" id="selectedEmotion" style="display: none;"></div>

        <!-- Category -->
        <div class="category-row">
          <select class="category-select" id="postCategory">
            <option value="">–ò–∑–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è</option>
            <option value="news">üì∞ –ù–æ–≤–∏–Ω–∏</option>
            <option value="infrastructure">üîß –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</option>
            <option value="municipal">üèõÔ∏è –û–±—â–∏–Ω–∞</option>
            <option value="initiatives">üí° –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∏</option>
            <option value="culture">üé® –ö—É–ª—Ç—É—Ä–Ω–∏ —Å—ä–±–∏—Ç–∏—è</option>
            <option value="other">üìã –î—Ä—É–≥–∏</option>
          </select>
        </div>

        <!-- Options Row -->
        <div class="post-options-row">
          <span class="options-text">–î–æ–±–∞–≤–∏ –∫—ä–º –ø—É–±–ª–∏–∫–∞—Ü–∏—è—Ç–∞:</span>
          <div class="options-buttons">
            <button class="option-btn" id="imageBtn" title="–°–Ω–∏–º–∫–∞">
              <i class="bi bi-image"></i>
            </button>
            <button class="option-btn" id="emotionBtn" title="–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ">
              <i class="bi bi-emoji-smile"></i>
            </button>
          </div>
        </div>

        <!-- Emotion Picker -->
        <div class="emotion-picker" id="emotionPicker" style="display: none;">
          <div class="emotions-list">
            <button class="emotion-item" data-emotion="üòä" data-text="—â–∞—Å—Ç–ª–∏–≤/–∞">
              <span class="emotion-icon">üòä</span>
              <span class="emotion-label">—â–∞—Å—Ç–ª–∏–≤/–∞</span>
            </button>
            <button class="emotion-item" data-emotion="üò¢" data-text="—Ç—ä–∂–µ–Ω/–∞">
              <span class="emotion-icon">üò¢</span>
              <span class="emotion-label">—Ç—ä–∂–µ–Ω/–∞</span>
            </button>
            <button class="emotion-item" data-emotion="üò†" data-text="—è–¥–æ—Å–∞–Ω/–∞">
              <span class="emotion-icon">üò†</span>
              <span class="emotion-label">—è–¥–æ—Å–∞–Ω/–∞</span>
            </button>
            <button class="emotion-item" data-emotion="üòç" data-text="–≤–ª—é–±–µ–Ω/–∞">
              <span class="emotion-icon">üòç</span>
              <span class="emotion-label">–≤–ª—é–±–µ–Ω/–∞</span>
            </button>
            <button class="emotion-item" data-emotion="ü§î" data-text="–∑–∞–º–∏—Å–ª–µ–Ω/–∞">
              <span class="emotion-icon">ü§î</span>
              <span class="emotion-label">–∑–∞–º–∏—Å–ª–µ–Ω/–∞</span>
            </button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn-cancel" id="cancelPost">–û—Ç–∫–∞–∑</button>
          <button class="btn-publish" id="submitPost" disabled>–ü—É–±–ª–∏–∫—É–≤–∞–π</button>
        </div>
      </div>

      <!-- Collapsed Actions -->
      <div class="create-post-actions" id="collapsedActions">
        <button class="action-item" onclick="expandCreateForm()">
          <i class="bi bi-pencil"></i>
          <span>–ü—É–±–ª–∏–∫–∞—Ü–∏—è</span>
        </button>
        <button class="action-item" onclick="expandCreateForm(); setTimeout(() => document.getElementById('imageBtn').click(), 100)">
          <i class="bi bi-image"></i>
          <span>–°–Ω–∏–º–∫–∞</span>
        </button>
        <button class="action-item" onclick="expandCreateForm(); setTimeout(() => document.getElementById('emotionBtn').click(), 100)">
          <i class="bi bi-emoji-smile"></i>
          <span>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span>
        </button>
      </div>

      <!-- Hidden File Input -->
      <input type="file" id="postImage" accept="image/*" style="display: none;">
    </div>

    <!-- Login Prompt for Guests -->
    <div class="login-prompt" th:if="${#authorization.expression('!isAuthenticated()')}">
      <div class="prompt-content">
        <i class="bi bi-person-circle"></i>
        <h3>–í–ª–µ–∑—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ —Å–∏</h3>
        <p>–ó–∞ –¥–∞ —Å—ä–∑–¥–∞–≤–∞—Ç–µ –∏ —Ö–∞—Ä–µ—Å–≤–∞—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –º–æ–ª—è –≤–ª–µ–∑—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ —Å–∏ –∏–ª–∏ —Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π—Ç–µ.</p>
        <div class="prompt-actions">
          <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" class="publications-btn btn-primary">–í—Ö–æ–¥</a>
          <a href="/register" class="publications-btn btn-outline-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        </div>
      </div>
    </div>

    <!-- Posts Feed -->
    <div class="posts-container" id="postsContainer">
      <!-- –ü–†–û–ú–Ø–ù–ê 2: –î–æ–±–∞–≤—è–º–µ data-avatar-container –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—Ä–∞–±–æ—Ç–≤–∞–Ω–µ -->
      <!-- Posts will be loaded here via JavaScript and avatarUtils will auto-process them -->
    </div>

    <!-- Loading Indicator -->
    <div class="loading-indicator" id="loadingIndicator">
      <div class="spinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
      </div>
      <span>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏...</span>
    </div>

    <!-- No More Posts Message -->
    <div class="no-more-posts" id="noMorePosts" style="display: none;">
      <i class="bi bi-check-circle-fill"></i>
      <span>–í—Å–∏—á–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏</span>
    </div>

    <!-- No Results Message -->
    <div class="no-results" id="noResults" style="display: none;">
      <i class="bi bi-search"></i>
      <h3>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h3>
      <p>–û–ø–∏—Ç–∞–π—Ç–µ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏—Ç–µ –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ –∏–ª–∏ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ.</p>
      <button class="publications-btn btn-primary" onclick="clearAllFilters()">
        <i class="bi bi-arrow-clockwise"></i>
        –ò–∑—á–∏—Å—Ç–∏ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ
      </button>
    </div>
  </main>

  <!-- Right Sidebar - Trending/Suggestions -->
  <aside class="right-sidebar">
    <!-- Trending Topics -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-trending-up"></i>
        –ü–æ–ø—É–ª—è—Ä–Ω–∏ —Ç–µ–º–∏
      </h3>
      <div class="trending-topics" id="trendingTopics">
        <div class="trending-item">
          <span class="hashtag">#–°–º–æ–ª—è–Ω–¶–µ–Ω—Ç—ä—Ä</span>
          <span class="count">24 –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</span>
        </div>
        <div class="trending-item">
          <span class="hashtag">#–ù–æ–≤–∏–ü—Ä–æ–µ–∫—Ç–∏</span>
          <span class="count">18 –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</span>
        </div>
        <div class="trending-item">
          <span class="hashtag">#–ï–∫–æ–ª–æ–≥–∏—è–°–º–æ–ª—è–Ω</span>
          <span class="count">15 –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</span>
        </div>
      </div>
    </div>

    <!-- Top Authors Today -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-trophy-fill"></i>
        –¢–æ–ø 5 –ê–≤—Ç–æ—Ä–∏ –Ω–∞ –¥–µ–Ω—è
      </h3>
      <div class="top-authors-today" id="topAuthorsToday">
        <div class="author-item" th:each="author : ${todayTopAuthors}" th:if="${author != null}">
          <div class="author-avatar avatar-placeholder"
               th:attr="data-user-image=${author.imageUrl ?: '/images/default-avatar.png'},data-username=${author.username ?: '–ê–Ω–æ–Ω–∏–º–µ–Ω'},data-user-id=${author.id}">
          </div>
          <div class="author-info">
            <div class="author-name" th:text="${author.username ?: '–ê–Ω–æ–Ω–∏–º–µ–Ω'}">–ê–≤—Ç–æ—Ä</div>
            <div class="author-stats" th:text="${(author.publicationsCount ?: 0) + ' –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–Ω–µ—Å'}">0 –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–Ω–µ—Å</div>
          </div>
          <button class="follow-btn"
                  th:if="${#authorization.expression('isAuthenticated()') and author.id != currentUserId}"
                  th:onclick="'followAuthor(' + ${author.id} + ')'">
            <i class="bi bi-person-plus"></i>
          </button>
        </div>

        <div th:if="${#lists.isEmpty(todayTopAuthors)}" class="no-authors">
          <p>–ù—è–º–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–Ω–µ—Å</p>
        </div>
      </div>
    </div>

    <!-- Statistics -->
    <div class="sidebar-widget">
      <h3 class="widget-title">
        <i class="bi bi-bar-chart-fill"></i>
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      </h3>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number" th:text="${totalPublications ?: 0}">0</div>
          <div class="stat-label">–û–±—â–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" th:text="${todayPublications ?: 0}">0</div>
          <div class="stat-label">–î–Ω–µ—Å</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" th:text="${weekPublications ?: 0}">0</div>
          <div class="stat-label">–¢–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" th:text="${activeUsers ?: 0}">83</div>
          <div class="stat-label">–û–Ω–ª–∞–π–Ω –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</div>
        </div>
      </div>
    </div>
  </aside>
</div>

<!-- Scroll to Top Button -->
<button class="scroll-to-top" id="scrollToTop" style="display: none;">
  <i class="bi bi-arrow-up"></i>
</button>

<!-- Mobile Overlay -->
<div class="mobile-overlay" id="mobileOverlay"></div>

<!-- Footer -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Post Detail Modal Fragment -->
<div th:replace="~{fragments/post-detail-modal :: postModal}"></div>
<!-- Scripts -->
<div th:replace="~{fragments/bottomHtmlStyles :: bottomStyles}"></div>


<script src="/js/publications/filtersManager.js"></script>
<script src="/js/publications/publicationsApi.js"></script>
<script src="/js/publications/postInteractions.js"></script>
<script src="/js/publications/publicationsMain.js"></script>

<script src="/js/publications/publicationDetailModal.js"></script>
<script src="/js/publications/commentsManager.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–º–µ avatar placeholders
    setTimeout(() => {
      initializeAvatarPlaceholders();
      // –°—ä—â–æ —Ç–∞–∫–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      if (window.avatarUtils) {
        window.avatarUtils.updateAll();
      }
    }, 300);
  });

  // –§—É–Ω–∫—Ü–∏—è –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ avatar placeholders
  function initializeAvatarPlaceholders() {
    document.querySelectorAll('.avatar-placeholder').forEach(placeholder => {
      const imageUrl = placeholder.getAttribute('data-user-image');
      const username = placeholder.getAttribute('data-username');
      const userId = placeholder.getAttribute('data-user-id');
      const size = placeholder.offsetWidth || 40;
      const className = placeholder.className.replace('avatar-placeholder', '').trim();

      if (window.createAvatar && username) {
        // –î–æ–±–∞–≤—è–º–µ user-id –∞—Ç—Ä–∏–±—É—Ç –∞–∫–æ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞
        const avatarHtml = window.createAvatar(imageUrl, username, size, className);

        // –°—ä–∑–¥–∞–≤–∞–º–µ –≤—Ä–µ–º–µ–Ω–µ–Ω div –∑–∞ –¥–∞ –ø–∞—Ä—Å–∏—Ä–∞–º–µ HTML-–∞
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = avatarHtml;
        const avatarElement = tempDiv.firstElementChild;

        // –î–æ–±–∞–≤—è–º–µ data –∞—Ç—Ä–∏–±—É—Ç–∏ –∞–∫–æ –≥–∏ –∏–º–∞
        if (userId) {
          avatarElement.setAttribute('data-user-id', userId);
        }
        if (imageUrl) {
          avatarElement.setAttribute('data-user-image', imageUrl);
        }
        if (username) {
          avatarElement.setAttribute('data-username', username);
        }

        // –ó–∞–º–µ–Ω—è–º–µ placeholder-–∞
        placeholder.outerHTML = avatarElement.outerHTML;
      }
    });
  }

  // –§—É–Ω–∫—Ü–∏—è –∑–∞ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ avatars —Å–ª–µ–¥ AJAX –∑–∞—è–≤–∫–∏
  function refreshAvatarsAfterAjax() {
    setTimeout(() => {
      initializeAvatarPlaceholders();
      if (window.avatarUtils) {
        window.avatarUtils.initializeAllAvatars();
      }
    }, 100);
  }

  // Export —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –∑–∞ –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ –≤ –¥—Ä—É–≥–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤–µ
  window.refreshAvatarsAfterAjax = refreshAvatarsAfterAjax;
  window.initializeAvatarPlaceholders = initializeAvatarPlaceholders;
</script>
</body>
</html>